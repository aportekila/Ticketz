

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Parts Implemented by Abdullah AKGÜL &mdash; ITUCSDB1835  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Parts Implemented by Muhammed Raşit EROL" href="member2.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ITUCSDB1835
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#database-design">Database Design</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#code">Code</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="member1.html">Parts Implemented by Ufuk DEMİR</a></li>
<li class="toctree-l3"><a class="reference internal" href="member2.html">Parts Implemented by Muhammed Raşit EROL</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Parts Implemented by Abdullah AKGÜL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#hotels-table">hotels Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#expeditions-table">expeditions Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tickets-table">tickets Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#images-table">images Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#seats-table">seats Table</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ITUCSDB1835</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developer Guide</a> &raquo;</li>
        
      <li>Parts Implemented by Abdullah AKGÜL</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developer/member3.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="parts-implemented-by-abdullah-akgul">
<h1>Parts Implemented by Abdullah AKGÜL<a class="headerlink" href="#parts-implemented-by-abdullah-akgul" title="Permalink to this headline">¶</a></h1>
<p>In this section, there are three main tables which are
hotels, expeditions and tickets table, also there two
extra tables which are images and seats table.
The responsibility of these tables belongs to Abdullah AKGÜL.
Attributes of tables which are mentioned above can be seen
in Figure 1.</p>
<div class="figure" id="id25">
<a class="reference internal image-reference" href="../_images/my_tables.png"><img alt="Abdullah AKGÜL's tables" src="../_images/my_tables.png" style="width: 1369.5px; height: 630.0px;" /></a>
<p class="caption"><span class="caption-text">Figure 1 - Tables that implemented by Abdullah AKGÜL</span></p>
</div>
<div class="section" id="hotels-table">
<h2>hotels Table<a class="headerlink" href="#hotels-table" title="Permalink to this headline">¶</a></h2>
<p>hotels table is created for recommending users proper hotels. hotels table is used for store the information about hotels.
The attributes of hotels table are hotel_id, name, email,
description, city, address, phone, website, logo.
hotel_id is primary key for hotels table. There is one more key attribute
that is city. city attribute is foreign key and the reference of the
city attribute is code attribute of the city table.</p>
<div class="figure" id="id26">
<a class="reference internal image-reference" href="../_images/hotel.png"><img alt="hotels table" src="../_images/hotel.png" style="width: 991.5px; height: 481.5px;" /></a>
<p class="caption"><span class="caption-text">Figure 2 - hotels table</span></p>
</div>
<p>Creation of hotels table and types of attributes of hotels table are given below;</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">hotels</span>
<span class="p">(</span>
    <span class="n">hotel_id</span> <span class="nb">SERIAL</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">25</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">email</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">description</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">250</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">city</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
    <span class="n">address</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">250</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">phone</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">website</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">50</span><span class="p">),</span>
    <span class="n">logo</span> <span class="n">BYTEA</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">city</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">city</span> <span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span>

<span class="p">)</span>
</pre></div>
</div>
<p>Only users that are admin can manipulate the hotels table.</p>
<div class="section" id="operations">
<h3>Operations<a class="headerlink" href="#operations" title="Permalink to this headline">¶</a></h3>
<p>Operations on the hotels table is handled with hotel
class that is given below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Hotel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">website</span><span class="p">,</span> <span class="n">logo</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phone</span> <span class="o">=</span> <span class="n">phone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">website</span> <span class="o">=</span> <span class="n">website</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="n">logo</span>
</pre></div>
</div>
<p>This class corresponds the hotels table in the database.
The attributes are same with hotel table.
This class provides ease on operations on the hotels table.</p>
<p>The operations on the hotels table are handled with given below class.
With this class database connection is provided and operations are handled with
functions of this class</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Hotel</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;postgres://itucs:itucspw@localhost:32768/itucsdb&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Operations on the hotels table is listed below.</p>
<div class="section" id="insert">
<h4>Insert<a class="headerlink" href="#insert" title="Permalink to this headline">¶</a></h4>
<p>Before insertion, inputs are validate in front side with JavaScript. The validation code is given below;</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">add</span><span class="p">()</span>
<span class="p">{</span>

    <span class="kd">var</span> <span class="nx">$captcha</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;#recaptcha&#39;</span> <span class="p">),</span>
        <span class="nx">response</span> <span class="o">=</span> <span class="nx">grecaptcha</span><span class="p">.</span><span class="nx">getResponse</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.msg-error&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span> <span class="s2">&quot;reCAPTCHA is mandatory&quot;</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">$captcha</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">)</span> <span class="p">){</span>
            <span class="nx">$captcha</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.msg-error&#39;</span> <span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">$captcha</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">);</span>
    <span class="p">}</span>


    <span class="kd">let</span> <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#hotel_name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;hotel_name&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#e_mail&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;e_mail&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#description&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#address&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#phone&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;phone&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>


    <span class="k">if</span><span class="p">(</span><span class="nx">deneme</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#s&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">image_count</span><span class="p">)</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;add_hotel&quot;</span><span class="p">).</span><span class="nx">submit</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">);</span>
            <span class="p">},</span> <span class="mi">2500</span><span class="p">);</span>
        <span class="p">});</span>


        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>After passing validation, insertion of hotel on hotels table can be performed with two ways.
The one of inserting is inserting hotel without logo attribute.
With this way, logo attribute will be NULL.
Related function is given below as add_hotel.
Other way is inserting hotel with logo attribute. This method is given below as add_hotel_with_logo.
The data for logo is provided with given below code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;logo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>These functions takes hotel parameter which is hotel class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_hotel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hotel</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO hotels ( name, email, description, city, address, phone, website) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">hotel</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">website</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add_hotel_with_logo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hotel_with_logo</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO hotels ( name, email, description, city, address, phone, website, logo) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">hotel_with_logo</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">hotel_with_logo</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">hotel_with_logo</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">hotel_with_logo</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">hotel_with_logo</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">hotel_with_logo</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="n">hotel_with_logo</span><span class="o">.</span><span class="n">website</span><span class="p">,</span> <span class="n">hotel_with_logo</span><span class="o">.</span><span class="n">logo</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>With this insertion functions new hotel will be added as a row to hotels table.</p>
</div>
<div class="section" id="read">
<h4>Read<a class="headerlink" href="#read" title="Permalink to this headline">¶</a></h4>
<p>There are three different methods for reading data from
hotels table. These methods are given below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_hotel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hotel_id</span><span class="p">):</span>
    <span class="n">_hotel</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM hotels WHERE hotel_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">hotel_id</span><span class="p">,))</span>
        <span class="n">hotel</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hotel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">_hotel</span> <span class="o">=</span> <span class="n">Hotel</span><span class="p">(</span><span class="n">hotel</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_hotel</span>

<span class="k">def</span> <span class="nf">get_hotels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">hotels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM hotels;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">hotel</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_hotel</span> <span class="o">=</span> <span class="n">Hotel</span><span class="p">(</span><span class="n">hotel</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
            <span class="n">hotels</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hotel</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_hotel</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">hotels</span>

<span class="k">def</span> <span class="nf">get_hotels_with_cities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">hotels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT hotel_id, city_name FROM hotels JOIN city ON hotels.city = city.code;&quot;</span><span class="p">)</span>
        <span class="n">hotels</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">hotels</span>
</pre></div>
</div>
<p>get_hotel method takes hotel_id as parameter. This method
simply returns desired hotel as hotel class.</p>
<p>get_hotels method is used for returning whole hotels in hotels table.
This methods returns an array that created with tuple
which is hotel_id, hotel as hotel class.</p>
<p>get_hotels_with_cities method is nearly same with get_hotels.
The difference is that get_hotels_with_cities returns whole hotels
in the hotels table with city names by using JOIN with city table.</p>
<p>The logo of the hotel is stored as BLOB. For showing logo
as picture format, the data of the logo decoded with given code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64encode</span>

<span class="n">logo</span> <span class="o">=</span> <span class="n">b64encode</span><span class="p">(</span><span class="n">temp_hotel</span><span class="o">.</span><span class="n">logo</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="update">
<h4>Update<a class="headerlink" href="#update" title="Permalink to this headline">¶</a></h4>
<p>Before updating, inputs are validate in front side with JavaScript. The validation code is given below;</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">edit</span><span class="p">()</span>
<span class="p">{</span>

    <span class="kd">var</span> <span class="nx">$captcha</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;#recaptcha&#39;</span> <span class="p">),</span>
    <span class="nx">response</span> <span class="o">=</span> <span class="nx">grecaptcha</span><span class="p">.</span><span class="nx">getResponse</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.msg-error&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span> <span class="s2">&quot;reCAPTCHA is mandatory&quot;</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">$captcha</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">)</span> <span class="p">){</span>
            <span class="nx">$captcha</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.msg-error&#39;</span> <span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">$captcha</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#hotel_name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;hotel_name&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#e_mail&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;e_mail&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#description&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#address&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;address&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#phone&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;phone&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>


    <span class="k">if</span><span class="p">(</span><span class="nx">deneme</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#s&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">image_count</span><span class="p">)</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;edit_hotel&quot;</span><span class="p">).</span><span class="nx">submit</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">);</span>
            <span class="p">},</span> <span class="mi">2500</span><span class="p">);</span>
        <span class="p">});</span>


        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>After validation of inputs, update hotel operation can be handled with given code below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_hotel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hotel_id</span><span class="p">,</span> <span class="n">hotel</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;UPDATE hotels SET name = </span><span class="si">%s</span><span class="s2">, email = </span><span class="si">%s</span><span class="s2">, description = </span><span class="si">%s</span><span class="s2">, city = </span><span class="si">%s</span><span class="s2">, address = </span><span class="si">%s</span><span class="s2">, phone = </span><span class="si">%s</span><span class="s2">, website = </span><span class="si">%s</span><span class="s2"> WHERE hotel_id = </span><span class="si">%s</span><span class="s2"> &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">hotel</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">website</span><span class="p">,</span> <span class="n">hotel_id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">update_hotel_with_logo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hotel_id</span><span class="p">,</span> <span class="n">hotel</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;UPDATE hotels SET name = </span><span class="si">%s</span><span class="s2">, email = </span><span class="si">%s</span><span class="s2">, description = </span><span class="si">%s</span><span class="s2">, city = </span><span class="si">%s</span><span class="s2">, address = </span><span class="si">%s</span><span class="s2">, phone = </span><span class="si">%s</span><span class="s2">, website = </span><span class="si">%s</span><span class="s2">, logo = </span><span class="si">%s</span><span class="s2"> WHERE hotel_id = </span><span class="si">%s</span><span class="s2"> &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">hotel</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">website</span><span class="p">,</span> <span class="n">hotel</span><span class="o">.</span><span class="n">logo</span><span class="p">,</span> <span class="n">hotel_id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>As seen on code, there are two method for updating hotel table.</p>
<p>update_hotel method takes hotel_id and hotel class as parameter.
This method updates the hotel whose hotel_id is equal to taken hotel_id
of taken hotel class but without logo attribute.</p>
<p>update_hotel_with_logo method takes hotel_id and hotel class as parameter.
This method updates the hotel whose hotel_id is equal to taken hotel_id
of taken hotel class.</p>
<p>After update operations, hotel table will be updated.</p>
</div>
<div class="section" id="delete">
<h4>Delete<a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h4>
<p>Delete operation is handled with given code below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_hotel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hotel_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM hotels WHERE hotel_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">hotel_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">delete_hotel_logo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hotel_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;UPDATE hotels SET logo = NULL WHERE hotel_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">hotel_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The deletion of hotel is handled with delete_hotel method. The selected hotel
will be deleted in hotels table by matching hotel_id taken as parameter.</p>
<p>The logo of hotel can be deleted without deleting the whole hotel information with
delete_hotel_logo method.
After delete_hotel_logo method, logo of the hotel will be NULL. The deletion of logo
is provided with matching hotel_id taken as parameter to this method.</p>
</div>
<div class="section" id="search">
<h4>Search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h4>
<p>The search operation on hotel table is handled with given code below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">hotels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">to_search</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM hotels JOIN city ON city.code = hotels.city WHERE (LOWER(name) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(email) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(description) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(address) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(website) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(city_name) like LOWER(</span><span class="si">%s</span><span class="s2">))    ;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">hotel</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_hotel</span> <span class="o">=</span> <span class="n">Hotel</span><span class="p">(</span><span class="n">hotel</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">hotel</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
            <span class="n">hotels</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">hotel</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_hotel</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">hotels</span>
</pre></div>
</div>
<p>The search method takes text as string. This string is searched in whole hotels table join with city table on city.
To search with case-insensitive string and whole data in hotels table
is used with LOWER function. This method returns array of tuple that has hotel_id and hotel
that has that string in anywhere on hotel information.</p>
</div>
</div>
</div>
<div class="section" id="expeditions-table">
<h2>expeditions Table<a class="headerlink" href="#expeditions-table" title="Permalink to this headline">¶</a></h2>
<p>expeditions table is created for providing expeditions to users by firms.
expeditions table is used for store the information about expeditions.
The attributes of expeditions table are expedition_id, from_city, from_ter,
to_city, to_ter, dep_time, arr_time, date, price, plane_id, current_cap, total_cap,
total_cap, driver_id, firm_id and document.
expedition_id is primary key for expeditions table.
There are six more key attributes
that are from_city, to_city, from_ter, to_ter, plane_id and driver_id.
from_city and to_city attributes are foreign keys and the reference of the
from_city and to_city attributes is code attribute of the city table.
from_ter and to_ter attributes are foreign keys and the reference of the
from_ter and to_ter attributes is terminal_id attribute of the terminal table.
plane_id is foreign key and the reference of the
plane_id attribute is vehicle_id attribute of the vehicles table.
driver_id is foreign key and the reference of the
driver_id attribute is firm_id attribute of the firms table.
Also total_cap attribute comes from
vehicle tables capacity attribute but it is not foreign key because the capacity attribute of
vehicles table is not primary key.</p>
<div class="figure" id="id27">
<a class="reference internal image-reference" href="../_images/expedition.png"><img alt="expeditions table" src="../_images/expedition.png" style="width: 1195.5px; height: 1021.5px;" /></a>
<p class="caption"><span class="caption-text">Figure 3 - expeditions table</span></p>
</div>
<p>Creation of expeditions table and types of attributes of expeditions table are given below;</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">expeditions</span>
<span class="p">(</span>
    <span class="n">expedition_id</span> <span class="nb">SERIAL</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">from_city</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">02</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">from_ter</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">to_city</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">02</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">to_ter</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">dep_time</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">arr_time</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="nb">date</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">price</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">price</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">),</span>
    <span class="n">plane_id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="p">,</span>
    <span class="n">current_cap</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">total_cap</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">driver_id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">firm_id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">document</span> <span class="n">BYTEA</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">from_city</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">city</span> <span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">to_city</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">city</span> <span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">from_ter</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">terminal</span> <span class="p">(</span><span class="n">terminal_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">to_ter</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">terminal</span> <span class="p">(</span><span class="n">terminal_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">plane_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">vehicles</span> <span class="p">(</span><span class="n">vehicle_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">driver_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">drivers</span> <span class="p">(</span><span class="n">driver_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">firms</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span>


<span class="p">)</span>
</pre></div>
</div>
<p>Only users that are admin and firms can manipulate the expeditions table.</p>
<div class="section" id="id1">
<h3>Operations<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Operations on the expeditions table is handled with expedition
class that is given below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Expedition</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_</span><span class="p">,</span> <span class="n">from_ter</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">to_ter</span><span class="p">,</span> <span class="n">dep_time</span><span class="p">,</span> <span class="n">arr_time</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">selected_plane</span><span class="p">,</span> <span class="n">driver_id</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">,</span> <span class="n">total_cap</span><span class="p">,</span> <span class="n">current_cap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">document</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_</span> <span class="o">=</span> <span class="n">from_</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">from_ter</span> <span class="o">=</span> <span class="n">from_ter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to</span> <span class="o">=</span> <span class="n">to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">to_ter</span> <span class="o">=</span> <span class="n">to_ter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dep_time</span> <span class="o">=</span> <span class="n">dep_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arr_time</span> <span class="o">=</span> <span class="n">arr_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selected_plane</span> <span class="o">=</span> <span class="n">selected_plane</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver_id</span> <span class="o">=</span> <span class="n">driver_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firm_id</span> <span class="o">=</span> <span class="n">firm_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_cap</span> <span class="o">=</span> <span class="n">total_cap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_cap</span> <span class="o">=</span> <span class="n">current_cap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="o">=</span> <span class="n">document</span>
</pre></div>
</div>
<p>This class corresponds the expeditions table in the database.
The attributes are same with expeditions table.
This class provides ease on operations on the expeditions table.</p>
<p>The operations on the expeditions table are handled with given below class.
With this class database connection is provided and operations are handled with
functions of this class</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Expedition</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;postgres://itucs:itucspw@localhost:32768/itucsdb&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Operations on the expeditions table is listed below.</p>
<div class="section" id="id2">
<h4>Insert<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>Before insertion, inputs are validate in front side with JavaScript. The validation code is given below;</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">add</span><span class="p">()</span>
<span class="p">{</span>

    <span class="kd">var</span> <span class="nx">$captcha</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;#recaptcha&#39;</span> <span class="p">),</span>
        <span class="nx">response</span> <span class="o">=</span> <span class="nx">grecaptcha</span><span class="p">.</span><span class="nx">getResponse</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.msg-error&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span> <span class="s2">&quot;reCAPTCHA is mandatory&quot;</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">$captcha</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">)</span> <span class="p">){</span>
            <span class="nx">$captcha</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.msg-error&#39;</span> <span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">$captcha</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">let</span> <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#from&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;from&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#from_ter&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#from_ter&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;from_ter&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#to&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;to&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#to_ter&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#to_ter&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;to_ter&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dep_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dep_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>

        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;dep_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>


    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#arr_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#arr_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;arr_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dep_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
    <span class="nx">arr</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;dep_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;00&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;23&#39;</span> <span class="p">){</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;dep_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
            <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;00&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;59&#39;</span><span class="p">){</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;dep_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
                <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">value</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#arr_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
    <span class="nx">arr</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;arr_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;00&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;23&#39;</span> <span class="p">){</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;arr_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
            <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;00&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;59&#39;</span><span class="p">){</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;arr_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
                <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">value</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#date&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
    <span class="nx">arr</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;00&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;12&#39;</span> <span class="p">){</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
            <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;00&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;31&#39;</span><span class="p">){</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
                <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="p">}</span>
            <span class="k">else</span><span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">4</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;2018&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;2200&#39;</span><span class="p">){</span>
                    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
                <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">tempDay</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#date&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">tempDay</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;</span><span class="nx">y</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;please pick a valid day&#39;</span><span class="p">)</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">tempDay</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span><span class="nx">y</span> <span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">tempDay</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="nx">m</span><span class="p">){</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;please pick a valid day&#39;</span><span class="p">)</span>
            <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">tempDay</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span><span class="nx">m</span> <span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">tempDay</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="nx">d</span><span class="p">){</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;please pick a valid day&#39;</span><span class="p">)</span>
                <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#price&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#price&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#selected_plane&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#selected_plane&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;selected_plane&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#driver&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#driver&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#to_ter&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#from_ter&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;from_ter&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;to_ter&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#arr_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dep_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;arr_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;dep_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">deneme</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;add_expedition&quot;</span><span class="p">).</span><span class="nx">submit</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">);</span>
            <span class="p">},</span> <span class="mi">2500</span><span class="p">);</span>
        <span class="p">});</span>


        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>After validation of inputs, insertion of expedition on expeditions table can be performed with two ways.
The one of inserting is inserting expedition without document attribute.
With this way, document attribute will be NULL.
Related function is given below as add_expedition.
Other way is inserting expedition with document attribute. This method is given below as add_expedition_with_document.
The data for document is provided with given below code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">document</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;document&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>These functions takes expedition parameter which is expedition class.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_expedition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expedition</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO expeditions ( from_city, from_ter, to_city, to_ter, dep_time, arr_time, date, price, plane_id, firm_id, total_cap, current_cap, driver_id) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">expedition</span><span class="o">.</span><span class="n">from_</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">from_ter</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">to</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">to_ter</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">dep_time</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">arr_time</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">price</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">selected_plane</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">firm_id</span><span class="p">,</span><span class="n">expedition</span><span class="o">.</span><span class="n">total_cap</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">current_cap</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">driver_id</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add_expedition_with_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expedition</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO expeditions ( from_city, from_ter, to_city, to_ter, dep_time, arr_time, date, price, plane_id, firm_id, total_cap, current_cap, driver_id, document) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">expedition</span><span class="o">.</span><span class="n">from_</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">from_ter</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">to</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">to_ter</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">dep_time</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">arr_time</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">price</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">selected_plane</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">firm_id</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">total_cap</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">current_cap</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">driver_id</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">document</span> <span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>Foreign key’s information are coming from other related tables.
With this insertion functions new expedition will be added as a row to expeditions table.</p>
</div>
<div class="section" id="id3">
<h4>Read<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>There are five different methods for reading data from
expeditions table. These methods are given below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_all_valid_expeditions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">expeditions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM expeditions where current_cap &lt; total_cap;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">expedition</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_expedition</span> <span class="o">=</span> <span class="n">Expedition</span><span class="p">(</span><span class="n">expedition</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                     <span class="n">expedition</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
                                     <span class="n">expedition</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
            <span class="n">_expedition</span><span class="o">.</span><span class="n">expedition_id</span>  <span class="o">=</span><span class="n">expedition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dayCompare</span><span class="p">(</span><span class="n">_expedition</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
                <span class="n">expeditions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">expedition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_expedition</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">expeditions</span>

<span class="k">def</span> <span class="nf">get_all_expeditions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">expeditions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM expeditions ;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">expedition</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_expedition</span> <span class="o">=</span> <span class="n">Expedition</span><span class="p">(</span><span class="n">expedition</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                     <span class="n">expedition</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
                                     <span class="n">expedition</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
            <span class="n">_expedition</span><span class="o">.</span><span class="n">expedition_id</span>  <span class="o">=</span><span class="n">expedition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">expeditions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">expedition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_expedition</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">expeditions</span>

<span class="k">def</span> <span class="nf">get_filtered_expeditions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">to_city</span><span class="p">,</span> <span class="n">to_ter</span><span class="p">,</span> <span class="n">from_city</span><span class="p">,</span> <span class="n">from_ter</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">max_price</span><span class="p">):</span>
    <span class="n">expeditions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">statement</span> <span class="o">=</span> <span class="s2">&quot; SELECT * FROM expeditions WHERE TRUE  &quot;</span>

    <span class="k">if</span> <span class="n">to_city</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">statement</span> <span class="o">+=</span> <span class="s2">&quot; and to_city = &#39;&quot;</span> <span class="o">+</span> <span class="n">to_city</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span>
    <span class="k">if</span> <span class="n">to_ter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">statement</span> <span class="o">+=</span> <span class="s2">&quot;and to_ter = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">to_ter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
    <span class="k">if</span> <span class="n">from_city</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">statement</span> <span class="o">+=</span> <span class="s2">&quot; and from_city = &#39;&quot;</span> <span class="o">+</span> <span class="n">from_city</span> <span class="o">+</span> <span class="s2">&quot;&#39; &quot;</span>
    <span class="k">if</span> <span class="n">from_ter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">statement</span> <span class="o">+=</span> <span class="s2">&quot; and from_ter = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">from_ter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
    <span class="k">if</span> <span class="n">firm_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">statement</span> <span class="o">+=</span> <span class="s2">&quot;and firm_id = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">firm_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
    <span class="k">if</span> <span class="n">date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">statement</span> <span class="o">+=</span> <span class="s2">&quot;and date like &#39;%&quot;</span> <span class="o">+</span> <span class="n">date</span> <span class="o">+</span> <span class="s2">&quot;%&#39; &quot;</span>
    <span class="k">if</span> <span class="n">max_price</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">statement</span> <span class="o">+=</span> <span class="s2">&quot;and price &lt;= &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">max_price</span><span class="p">)</span>
    <span class="n">statement</span> <span class="o">+=</span> <span class="s2">&quot;and current_cap &lt; total_cap&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">expedition</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_expedition</span> <span class="o">=</span> <span class="n">Expedition</span><span class="p">(</span><span class="n">expedition</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                     <span class="n">expedition</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
                                     <span class="n">expedition</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
            <span class="n">_expedition</span><span class="o">.</span><span class="n">expedition_id</span>  <span class="o">=</span><span class="n">expedition</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dayCompare</span><span class="p">(</span><span class="n">_expedition</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
                <span class="n">expeditions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">expedition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_expedition</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">expeditions</span>

<span class="k">def</span> <span class="nf">get_firms_expedition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">):</span>
    <span class="n">expeditions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM expeditions WHERE firm_id = </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">,))</span>
        <span class="k">for</span> <span class="n">expedition</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_expedition</span> <span class="o">=</span> <span class="n">Expedition</span><span class="p">(</span><span class="n">expedition</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                     <span class="n">expedition</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
                                     <span class="n">expedition</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
            <span class="n">expeditions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">expedition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_expedition</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">expeditions</span>


<span class="k">def</span> <span class="nf">get_expedition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expedition_id</span><span class="p">):</span>
    <span class="n">_expedition</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM expeditions WHERE expedition_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">expedition_id</span><span class="p">,))</span>
        <span class="n">expedition</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">expedition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">_expedition</span> <span class="o">=</span> <span class="n">Expedition</span><span class="p">(</span><span class="n">expedition</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                     <span class="n">expedition</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
                                     <span class="n">expedition</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_expedition</span>
</pre></div>
</div>
<p>get_all_valid_expeditions returns whole expeditions that are up-to-date and
have empty seat. Empty seat checks whether current_cap attribute is smaller
than total_cap. The up-to-date checking is done by dayCompare function that is given below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>

<span class="n">str_today</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">day</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">dayCompare</span><span class="p">(</span> <span class="n">toCompare</span><span class="p">):</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">str_today</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">toCompare</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">t0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">t1</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="n">t0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">t1</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">t0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">t1</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">t0</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">t1</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">t0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">t1</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
</pre></div>
</div>
<p>This dayCompare compare function takes the expedition’s date attribute as parameter.
Then compare it with today’s date with desired format.
After checking, get_all_valid_expeditions method returns array of tuples that has
expedition_id and expedition that is expedition class.</p>
<p>get_all_expeditions method is used for returns whole expeditions in expeditions table.
This methods returns an array that created with tuple
which is expedition_id, expedition as expedition class.</p>
<p>get_filtered_expeditions method is filter the expeditions.
The filter is done with taken parameters that are to_city, o_city, to_ter, from_city, from_ter, firm_id, date and max_price .
This methods returns an array that created with tuple
which is expedition_id, expedition as expedition class.</p>
<p>get_firms_expedition method takes firm_id as parameter.
This method used for getting the firm’s expeditions by matching firm_id.
This methods returns an array that created with tuple
which is expedition_id, expedition as expedition class.</p>
<p>get_expedition method takes expedition_id as parameter.
get_expedition method is used for returning desired expedition
by matching expedition_id.</p>
<p>The document of the expedition is stored as BLOB. For showing document
as PDF format, the data of the document handled with given code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">send_file</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>

<span class="n">file_data</span> <span class="o">=</span> <span class="n">expedition_db</span><span class="o">.</span><span class="n">get_expedition</span><span class="p">(</span><span class="n">expedition_id</span><span class="p">)</span><span class="o">.</span><span class="n">document</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">expedition_id</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.pdf&#39;</span>
<span class="k">return</span> <span class="n">send_file</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">file_data</span><span class="p">),</span> <span class="n">attachment_filename</span> <span class="o">=</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4>Update<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>Before updating, inputs are validate in front side with JavaScript. The validation code is given below;</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">add</span><span class="p">()</span>
<span class="p">{</span>

    <span class="kd">var</span> <span class="nx">$captcha</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;#recaptcha&#39;</span> <span class="p">),</span>
        <span class="nx">response</span> <span class="o">=</span> <span class="nx">grecaptcha</span><span class="p">.</span><span class="nx">getResponse</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.msg-error&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span> <span class="s2">&quot;reCAPTCHA is mandatory&quot;</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">$captcha</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">)</span> <span class="p">){</span>
            <span class="nx">$captcha</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.msg-error&#39;</span> <span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">$captcha</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">let</span> <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">true</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#from&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;from&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#from_ter&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#from_ter&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;from_ter&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#to&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;to&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#to_ter&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#to_ter&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;to_ter&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dep_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dep_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>

        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;dep_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>


    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#arr_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#arr_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;arr_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="kd">let</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dep_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
    <span class="nx">arr</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;dep_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;00&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;23&#39;</span> <span class="p">){</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;dep_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
            <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;00&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;59&#39;</span><span class="p">){</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;dep_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
                <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">value</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#arr_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
    <span class="nx">arr</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;arr_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;00&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;23&#39;</span> <span class="p">){</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;arr_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
            <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;00&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;59&#39;</span><span class="p">){</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;arr_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
                <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">value</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#date&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
    <span class="nx">arr</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;00&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;12&#39;</span> <span class="p">){</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
            <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;00&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;31&#39;</span><span class="p">){</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
                <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="p">}</span>
            <span class="k">else</span><span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">length</span> <span class="o">!=</span> <span class="mi">4</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="s1">&#39;2018&#39;</span> <span class="o">||</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="s1">&#39;2200&#39;</span><span class="p">){</span>
                    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
                <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">tempDay</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#date&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">tempDay</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;</span><span class="nx">y</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;please pick a valid day&#39;</span><span class="p">)</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">tempDay</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span><span class="nx">y</span> <span class="p">){</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">tempDay</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="nx">m</span><span class="p">){</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
            <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;please pick a valid day&#39;</span><span class="p">)</span>
            <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">tempDay</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span><span class="nx">m</span> <span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">tempDay</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="nx">d</span><span class="p">){</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
                <span class="nx">alert</span><span class="p">(</span><span class="s1">&#39;please pick a valid day&#39;</span><span class="p">)</span>
                <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#price&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#price&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;price&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#selected_plane&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#selected_plane&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;selected_plane&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#driver&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span><span class="s2">&quot;&quot;</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#driver&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="kc">null</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#to_ter&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span><span class="o">==</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#from_ter&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;from_ter&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;to_ter&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#arr_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span> <span class="o">==</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#dep_time&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;arr_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;dep_time&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">deneme</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;add_expedition&quot;</span><span class="p">).</span><span class="nx">submit</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">);</span>
            <span class="p">},</span> <span class="mi">2500</span><span class="p">);</span>
        <span class="p">});</span>


        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>After validation of inputs, update expedition operation can be handled with given code below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_expedition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expedition_id</span><span class="p">,</span> <span class="n">expedition</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;UPDATE expeditions SET from_city = </span><span class="si">%s</span><span class="s2">, from_ter = </span><span class="si">%s</span><span class="s2">, to_city = </span><span class="si">%s</span><span class="s2">, to_ter = </span><span class="si">%s</span><span class="s2">, dep_time = </span><span class="si">%s</span><span class="s2">, arr_time = </span><span class="si">%s</span><span class="s2">, date = </span><span class="si">%s</span><span class="s2">, price = </span><span class="si">%s</span><span class="s2">, plane_id = </span><span class="si">%s</span><span class="s2">, firm_id = </span><span class="si">%s</span><span class="s2">, total_cap = </span><span class="si">%s</span><span class="s2">, current_cap = </span><span class="si">%s</span><span class="s2">, driver_id = </span><span class="si">%s</span><span class="s2"> WHERE expedition_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">expedition</span><span class="o">.</span><span class="n">from_</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">from_ter</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">to</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">to_ter</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">dep_time</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">arr_time</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">price</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">selected_plane</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">firm_id</span><span class="p">,</span><span class="n">expedition</span><span class="o">.</span><span class="n">total_cap</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">current_cap</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">driver_id</span><span class="p">,</span> <span class="n">expedition_id</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">update_expedition_with_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expedition_id</span><span class="p">,</span> <span class="n">expedition</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;UPDATE expeditions SET from_city = </span><span class="si">%s</span><span class="s2">, from_ter = </span><span class="si">%s</span><span class="s2">, to_city = </span><span class="si">%s</span><span class="s2">, to_ter = </span><span class="si">%s</span><span class="s2">, dep_time = </span><span class="si">%s</span><span class="s2">, arr_time = </span><span class="si">%s</span><span class="s2">, date = </span><span class="si">%s</span><span class="s2">, price = </span><span class="si">%s</span><span class="s2">, plane_id = </span><span class="si">%s</span><span class="s2">, firm_id = </span><span class="si">%s</span><span class="s2">, total_cap = </span><span class="si">%s</span><span class="s2">, current_cap = </span><span class="si">%s</span><span class="s2">, driver_id = </span><span class="si">%s</span><span class="s2">, document = </span><span class="si">%s</span><span class="s2"> WHERE expedition_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">expedition</span><span class="o">.</span><span class="n">from_</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">from_ter</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">to</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">to_ter</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">dep_time</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">arr_time</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">price</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">selected_plane</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">firm_id</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">total_cap</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">current_cap</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">driver_id</span><span class="p">,</span> <span class="n">expedition</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="n">expedition_id</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>As seen on code, there are two method for updating expeditions table.</p>
<p>update_expedition method takes expedition_id and expedition class as parameter.
This method updates the expedition whose expedition_id is equal to taken expedition_id
of taken expedition class but without document attribute.</p>
<p>update_expedition_with_document method takes expedition_id and expedition class as parameter.
This method updates the expedition whose expedition_id is equal to taken expedition_id
of taken expedition class.</p>
<p>After update operations, expeditions table will be updated.</p>
</div>
<div class="section" id="id5">
<h4>Delete<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>Delete operation is handled with given code below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_expedition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expedition_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM expeditions WHERE expedition_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">expedition_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">delete_expedition_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expedition_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;UPDATE expeditions SET document = NULL WHERE expedition_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">expedition_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The deletion of expedition is handled with delete_expedition method. The selected expedition
will be deleted in expeditions table by matching expedition_id taken as parameter.</p>
<p>The document of expedition can be deleted without deleting the whole expedition information with
delete_expedition_document method.
After delete_expedition_document method, document of the expedition will be NULL. The deletion of document
is provided with matching expedition_id taken as parameter to this method.</p>
</div>
<div class="section" id="id6">
<h4>Search<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>The search operation on expedition table is handled with given code below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">expeditions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">to_search</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">isInt</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>

            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;select * from expeditions where expedition_id in (</span>
<span class="s2">                            select expedition_id</span>
<span class="s2">                            from expeditions, city as to_city, firms, city as from_city, terminal as to_ter, terminal as from_ter</span>
<span class="s2">                            where (firms.firm_id = expeditions.firm_id and expeditions.to_city = to_city.code and expeditions.from_city = from_city.code and expeditions.to_ter = to_ter.terminal_id and expeditions.from_ter = from_ter.terminal_id )</span>
<span class="s2">                            and</span>
<span class="s2">                            ( (price = </span><span class="si">%s</span><span class="s2">) or (LOWER(to_city.city_name) like LOWER(</span><span class="si">%s</span><span class="s2">)) or ( LOWER(firms.name) like LOWER(</span><span class="si">%s</span><span class="s2">) ) or ( LOWER(from_city.city_name) like LOWER(</span><span class="si">%s</span><span class="s2">) ) or (LOWER(date) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(dep_time) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(arr_time) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(from_ter.terminal_name) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(to_ter.terminal_name) like LOWER(</span><span class="si">%s</span><span class="s2">))))&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="p">,</span><span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span><span class="n">to_search</span><span class="p">,</span><span class="n">to_search</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;select * from expeditions where expedition_id in (</span>
<span class="s2">                            select expedition_id</span>
<span class="s2">                            from expeditions, city as to_city, firms, city as from_city, terminal as to_ter, terminal as from_ter</span>
<span class="s2">                            where (firms.firm_id = expeditions.firm_id and expeditions.to_city = to_city.code and expeditions.from_city = from_city.code and expeditions.to_ter = to_ter.terminal_id and expeditions.from_ter = from_ter.terminal_id )</span>
<span class="s2">                            and</span>
<span class="s2">                            (  (LOWER(to_city.city_name) like LOWER(</span><span class="si">%s</span><span class="s2">)) or ( LOWER(firms.name) like LOWER(</span><span class="si">%s</span><span class="s2">) ) or ( LOWER(from_city.city_name) like LOWER(</span><span class="si">%s</span><span class="s2">) ) or (LOWER(date) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(dep_time) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(arr_time) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(from_ter.terminal_name) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(to_ter.terminal_name) like LOWER(</span><span class="si">%s</span><span class="s2">))))&quot;&quot;&quot;</span><span class="p">,</span>
                           <span class="p">(</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span>
                            <span class="n">to_search</span><span class="p">,))</span>

        <span class="k">for</span> <span class="n">expedition</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>

            <span class="n">_expedition</span> <span class="o">=</span> <span class="n">Expedition</span><span class="p">(</span><span class="n">expedition</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                                     <span class="n">expedition</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span>
                                     <span class="n">expedition</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">expedition</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">dayCompare</span><span class="p">(</span><span class="n">_expedition</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
                <span class="n">expeditions</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">expedition</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_expedition</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">expeditions</span>
</pre></div>
</div>
<p>The search method takes text as string. This string is searched in whole expeditions table join with related tables.
To search with case-insensitive string and whole data in expeditions table
is used with LOWER function.
Also the code checks whether given string can be integer or not. If given string can be integer
code will be search on price too. The checking code is given below.
This method returns array of tuple that has expedition_id and expedition
that has that string in anywhere on expedition information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">isInt</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
  <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="related-systems">
<h3>Related Systems<a class="headerlink" href="#related-systems" title="Permalink to this headline">¶</a></h3>
<p>The usage of the expeditions table are listed below.</p>
<div class="section" id="buy-ticket">
<h4>Buy Ticket<a class="headerlink" href="#buy-ticket" title="Permalink to this headline">¶</a></h4>
<p>When a user buy a ticket, expedition table should be updated. This updating is given below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">bought</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expedition_id</span> <span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;UPDATE expeditions SET current_cap = current_cap + 1 WHERE expedition_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">expedition_id</span><span class="p">,</span> <span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>bought method takes expedition_id as parameter. When user buy a ticket for an expedition,
current_cap attribute of that expedition should be incremented by one. bought method updates
the expedition table with this purpose.</p>
</div>
<div class="section" id="cancel-ticket">
<h4>Cancel Ticket<a class="headerlink" href="#cancel-ticket" title="Permalink to this headline">¶</a></h4>
<p>When a user cancel a ticket, expedition table should be updated. This updating is given below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cancelled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expedition_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;UPDATE expeditions SET current_cap = current_cap - 1 WHERE expedition_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">expedition_id</span><span class="p">,))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>cancelled method takes expedition_id as parameter. When user cancel a ticket for an expedition,
current_cap attribute of that expedition should be decremented by one. cancelled method updates
the expedition table with this purpose.</p>
</div>
</div>
</div>
<div class="section" id="tickets-table">
<h2>tickets Table<a class="headerlink" href="#tickets-table" title="Permalink to this headline">¶</a></h2>
<p>tickets table is created for holding the tickets of the users.
tickets table is used for store the information about tickets.
The attributes of expeditions table are expedition_id, user_id, seat_number,
ticket_id, bought_at, edited_at, is_cancelable, extra_baggage, price and price.
ticket_id is primary key for tickets table.
There are 4 more key attributes
that are expedition_id, user_id, seat_number and seat_number.
expedition_id, user_id and seat_number attributes are foreign keys and the reference of the
expedition_id, user_id and seat_number is expedition_id, user_id and seat_number attributes of the seat table.
firm_id is foreign key and the reference of the
firm_id attribute is firm_id attribute of the firms table.
Also price attribute comes from
expedition tables price attribute but it is not foreign key because the price attribute of
vehicles table is not primary key and tickets price can be changed with sales that are provided to users.</p>
<div class="figure" id="id28">
<a class="reference internal image-reference" href="../_images/tickets.png"><img alt="tickets table" src="../_images/tickets.png" style="width: 895.5px; height: 942.0px;" /></a>
<p class="caption"><span class="caption-text">Figure 4 - tickets table</span></p>
</div>
<p>Creation of tickets table and types of attributes of tickets table are given below;</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">tickets</span><span class="p">(</span>
    <span class="n">expedition_id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">user_id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">seat_number</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">ticket_id</span> <span class="nb">SERIAL</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">bought_at</span> <span class="k">TIMESTAMP</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
    <span class="n">edited_at</span> <span class="k">TIMESTAMP</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
    <span class="n">is_cancelable</span> <span class="nb">BOOLEAN</span> <span class="k">DEFAULT</span> <span class="k">FALSE</span><span class="p">,</span>
    <span class="n">extra_baggage</span> <span class="nb">BOOLEAN</span> <span class="k">DEFAULT</span> <span class="k">FALSE</span><span class="p">,</span>
    <span class="n">price</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">firm_id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">expedition_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">seat_number</span><span class="p">),</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ticket_id</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">expedition_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">seat_number</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">seats</span> <span class="p">(</span><span class="n">expedition_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">seat_number</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">firms</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Only users can manipulate the tickets table.</p>
<div class="section" id="id7">
<h3>Operations<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>Operations on the tickets table is handled with expedition
class that is given below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Ticket</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expedition_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">seat_number</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">extra_baggage</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">is_cancelable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">bought_at</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">edited_at</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expedition_id</span> <span class="o">=</span> <span class="n">expedition_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seat_number</span> <span class="o">=</span> <span class="n">seat_number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extra_baggage</span> <span class="o">=</span> <span class="n">extra_baggage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_cancelable</span> <span class="o">=</span> <span class="n">is_cancelable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bought_at</span> <span class="o">=</span> <span class="n">bought_at</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edited_at</span> <span class="o">=</span> <span class="n">edited_at</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firm_id</span> <span class="o">=</span> <span class="n">firm_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span>
</pre></div>
</div>
<p>This class corresponds the tickets table in the database.
The attributes are same with tickets table.
This class provides ease on operations on the tickets table.</p>
<p>The operations on the tickets table are handled with given below class.
With this class database connection is provided and operations are handled with
functions of this class</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Ticket</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;postgres://itucs:itucspw@localhost:32768/itucsdb&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Operations on the tickets table is listed below.</p>
<div class="section" id="id8">
<h4>Insert<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>Before insertion, inputs are validate in front side with JavaScript. The validation code is given below;</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">add</span><span class="p">()</span>
<span class="p">{</span>

    <span class="kd">let</span> <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;checkbox&quot;]:checked&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;checkbox&quot;]:checked&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;plane&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">deneme</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;add_ticket&quot;</span><span class="p">).</span><span class="nx">submit</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">);</span>
            <span class="p">},</span> <span class="mi">2500</span><span class="p">);</span>
        <span class="p">});</span>


        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>After validation of inputs, insertion of ticket on tickets table can be performed with
given below code;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_ticket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticket</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO tickets ( expedition_id, user_id, seat_number, is_cancelable, extra_baggage, firm_id, price) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">ticket</span><span class="o">.</span><span class="n">expedition_id</span><span class="p">,</span> <span class="n">ticket</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ticket</span><span class="o">.</span><span class="n">seat_number</span><span class="p">,</span> <span class="n">ticket</span><span class="o">.</span><span class="n">is_cancelable</span><span class="p">,</span> <span class="n">ticket</span><span class="o">.</span><span class="n">extra_baggage</span><span class="p">,</span> <span class="n">ticket</span><span class="o">.</span><span class="n">firm_id</span><span class="p">,</span> <span class="n">ticket</span><span class="o">.</span><span class="n">price</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>This method takes ticket parameter which is ticket class.
Foreign key’s information are coming from other related tables and session.
With this insertion method, new ticket will be added as a row to tickets table.</p>
</div>
<div class="section" id="id9">
<h4>Read<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>There are two different methods for reading data from
tickets table. These methods are given below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_tickets_of_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
    <span class="n">tickets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM tickets WHERE user_id = </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_ticket</span> <span class="o">=</span> <span class="n">Ticket</span><span class="p">(</span><span class="n">ticket</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">tickets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ticket</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">_ticket</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tickets</span>

<span class="k">def</span> <span class="nf">get_ticket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticket_id</span><span class="p">):</span>
    <span class="n">tickets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM tickets WHERE ticket_id = </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ticket_id</span><span class="p">,</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_ticket</span> <span class="o">=</span> <span class="n">Ticket</span><span class="p">(</span><span class="n">ticket</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">tickets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_ticket</span><span class="p">)</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tickets</span>
</pre></div>
</div>
<p>get_tickets_of_users method takes user_id as parameter.
This method used for getting the users’s tickets by matching user_id.
This methods returns an array that created with tuple
which is ticket_id, ticket as ticket class.</p>
<p>get_ticket method takes get_ticket as parameter.
get_ticket method is used for returning desired ticket
by matching get_ticket.</p>
</div>
<div class="section" id="id10">
<h4>Update<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>Users can update their ticket before the date of the expedition.
This is provided with given codes below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">dayCompare</span><span class="p">(</span><span class="n">temp_expedition</span><span class="o">.</span><span class="n">date</span><span class="p">):</span>
    <span class="n">ticket</span><span class="o">.</span><span class="n">editable</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% if ticket.editable %}
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/ticket/edit/{{ ticket.ticket_id }}&quot;</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-lg btn-block  btn-info &quot;</span><span class="p">&gt;</span>Edit Ticket <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
{% endif %}
</pre></div>
</div>
<p>Before updating, inputs are validate in front side with JavaScript. The validation code is given below;</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">add</span><span class="p">()</span>
<span class="p">{</span>

    <span class="kd">let</span> <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;checkbox&quot;]:checked&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="s1">&#39;input[type=&quot;checkbox&quot;]:checked&#39;</span><span class="p">).</span><span class="nx">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;plane&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">deneme</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">deneme</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;add_ticket&quot;</span><span class="p">).</span><span class="nx">submit</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">);</span>
            <span class="p">},</span> <span class="mi">2500</span><span class="p">);</span>
        <span class="p">});</span>


        <span class="k">return</span> <span class="kc">false</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
<p>After validation of inputs, update ticket operation can be handled with given code below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_ticket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticket</span><span class="p">,</span><span class="n">new_seat_number</span><span class="p">,</span> <span class="n">new_cancel</span><span class="p">,</span> <span class="n">new_baggage</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;UPDATE tickets SET seat_number = </span><span class="si">%s</span><span class="s2">, is_cancelable = </span><span class="si">%s</span><span class="s2">, extra_baggage = </span><span class="si">%s</span><span class="s2">, edited_at = CURRENT_TIMESTAMP WHERE expedition_id = </span><span class="si">%s</span><span class="s2"> AND user_id = </span><span class="si">%s</span><span class="s2"> AND seat_number = </span><span class="si">%s</span><span class="s2"> &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span> <span class="n">new_seat_number</span><span class="p">,</span> <span class="n">new_cancel</span><span class="p">,</span> <span class="n">new_baggage</span> <span class="p">,</span><span class="n">ticket</span><span class="o">.</span><span class="n">expedition_id</span><span class="p">,</span> <span class="n">ticket</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">new_seat_number</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>update_ticket method takes ticket as ticket class ,new_seat_number, new_cancel, new_baggage as parameter.
This method updates the ticket whose ticket_id is equal to taken expedition_id of
taken ticket class</p>
<p>After update operations, tickets table will be updated.</p>
</div>
<div class="section" id="id11">
<h4>Delete<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>Users can delete only they select cancellable ticket when they buy ticket.
This is provided with given code below;</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% if ticket.is_cancelable %}
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/ticket/delete/{{ ticket.ticket_id }}&quot;</span> <span class="na">target</span><span class="o">=</span><span class="s">&quot;_blank&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">&quot;$(&#39;#ticket-{{ ticket.ticket_id }}&#39;).hide();&quot;</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;button&quot;</span>  <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-lg btn-block  btn-custom &quot;</span><span class="p">&gt;</span>Cancel The Ticket <span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
{% endif %}
</pre></div>
</div>
<p>Delete operation is handled with given code below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_ticket</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ticket_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM tickets WHERE ticket_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">ticket_id</span><span class="p">,</span> <span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The deletion of ticket is handled with delete_ticket method. The selected ticket
will be deleted in tickets table by matching ticket_id taken as parameter.</p>
</div>
<div class="section" id="id12">
<h4>Search<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>The search operation on ticket table is handled with given code below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">tickets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">to_search</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">isInt</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>

            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;select * from tickets where ticket_id in (</span>
<span class="s2">                            select ticket_id</span>
<span class="s2">                            from tickets, expeditions, city as to_city, firms, city as from_city, terminal as to_ter, terminal as from_ter</span>
<span class="s2">                            where (firms.firm_id = tickets.firm_id and expeditions.to_city = to_city.code and expeditions.from_city = from_city.code and expeditions.to_ter = to_ter.terminal_id and expeditions.from_ter = from_ter.terminal_id )</span>
<span class="s2">                            and</span>
<span class="s2">                            ( (tickets.price = </span><span class="si">%s</span><span class="s2">) or (LOWER(to_city.city_name) like LOWER(</span><span class="si">%s</span><span class="s2">)) or ( LOWER(firms.name) like LOWER(</span><span class="si">%s</span><span class="s2">) ) or ( LOWER(from_city.city_name) like LOWER(</span><span class="si">%s</span><span class="s2">) ) or (LOWER(date) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(dep_time) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(arr_time) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(from_ter.terminal_name) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(to_ter.terminal_name) like LOWER(</span><span class="si">%s</span><span class="s2">))))&quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="p">,</span><span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span><span class="n">to_search</span><span class="p">,</span><span class="n">to_search</span><span class="p">,</span> <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;select * from tickets where ticket_id in (</span>
<span class="s2">                            select ticket_id</span>
<span class="s2">                            from tickets, city as to_city, firms, city as from_city, terminal as to_ter, terminal as from_ter</span>
<span class="s2">                            where (firms.firm_id = tickets.firm_id and expeditions.to_city = to_city.code and expeditions.from_city = from_city.code and expeditions.to_ter = to_ter.terminal_id and expeditions.from_ter = from_ter.terminal_id )</span>
<span class="s2">                            and</span>
<span class="s2">                            (  (LOWER(to_city.city_name) like LOWER(</span><span class="si">%s</span><span class="s2">)) or ( LOWER(firms.name) like LOWER(</span><span class="si">%s</span><span class="s2">) ) or ( LOWER(from_city.city_name) like LOWER(</span><span class="si">%s</span><span class="s2">) ) or (LOWER(date) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(dep_time) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(arr_time) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(from_ter.terminal_name) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(to_ter.terminal_name) like LOWER(</span><span class="si">%s</span><span class="s2">))))&quot;&quot;&quot;</span><span class="p">,</span>
                           <span class="p">(</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span>
                            <span class="n">to_search</span><span class="p">,))</span>

        <span class="k">for</span> <span class="n">ticket</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_ticket</span> <span class="o">=</span> <span class="n">Ticket</span><span class="p">(</span><span class="n">ticket</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ticket</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
            <span class="n">tickets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ticket</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">_ticket</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tickets</span>
</pre></div>
</div>
<p>The search method takes text as string. This string is searched in whole tickets table join with related tables.
To search with case-insensitive string and whole data in tickets table
is used with LOWER function.
Also the code checks whether given string can be integer or not. If given string can be integer
code will be search on price too. The checking code is given below.
This method returns array of tuple that has ticket_id and ticket
that has that string in anywhere on ticket information.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">isInt</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">True</span>
  <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id13">
<h3>Related Systems<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>The usage of the tickets table are listed below.</p>
<div class="section" id="mail-send">
<h4>Mail Send<a class="headerlink" href="#mail-send" title="Permalink to this headline">¶</a></h4>
<p>When a user buy a ticket, system sends mail
to user to inform the user. The mail template
that will be send and code are given below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mail</span>

<span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Ticketz </span><span class="se">\n</span><span class="s2">&quot;</span> \
<span class="s2">&quot;Ticket Succesfully Bought </span><span class="se">\n</span><span class="s2">&quot;</span> \
<span class="s2">&quot;Thank you &quot;</span> <span class="o">+</span> <span class="n">user</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> \
<span class="s2">&quot;Your Seat Number: &quot;</span> <span class="o">+</span> <span class="n">seat_number</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> \
<span class="s2">&quot;Good Luck in &quot;</span> <span class="o">+</span> <span class="n">city_name</span>
<span class="n">mail</span><span class="o">.</span><span class="n">send_email</span><span class="p">(</span> <span class="s2">&quot;Ticketz - Ticket Bought&quot;</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">user</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">smtplib</span>

<span class="k">def</span> <span class="nf">send_email</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">to</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">server</span> <span class="o">=</span> <span class="n">smtplib</span><span class="o">.</span><span class="n">SMTP</span><span class="p">(</span><span class="s1">&#39;smtp.gmail.com:587&#39;</span><span class="p">)</span>
        <span class="n">server</span><span class="o">.</span><span class="n">ehlo</span><span class="p">()</span>
        <span class="n">server</span><span class="o">.</span><span class="n">starttls</span><span class="p">()</span>
        <span class="n">server</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s2">&quot;ticketz.ticket.info@gmail.com&quot;</span><span class="p">,</span> <span class="s2">&quot;Ticketz123.&quot;</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;Subject: {}</span><span class="se">\n\n</span><span class="s1">{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="n">server</span><span class="o">.</span><span class="n">sendmail</span><span class="p">(</span><span class="s2">&quot;ticketz.ticket.info@gmail.com&quot;</span><span class="p">,</span> <span class="n">to</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="n">server</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;fail: email send&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="images-table">
<h2>images Table<a class="headerlink" href="#images-table" title="Permalink to this headline">¶</a></h2>
<p>images table is created for holding the photos of the hotels. Since
hotels can have more than one photo this table required.
images table is used for store the information about images.
The attributes of images table are hotel_id, image_id and file_data.
hotel_id and hotel_id are primary key for images table.
hotel_id attribute is also foreign key and the reference of the
hotel_id attribute is hotel_id attribute of the hotels table.</p>
<div class="figure" id="id29">
<a class="reference internal image-reference" href="../_images/images.png"><img alt="images table" src="../_images/images.png" style="width: 628.5px; height: 481.5px;" /></a>
<p class="caption"><span class="caption-text">Figure 5 - images table</span></p>
</div>
<p>Creation of images table and types of attributes of images table are given below;</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">images</span><span class="p">(</span>
    <span class="n">hotel_id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">image_id</span> <span class="nb">SERIAL</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">file_data</span> <span class="n">BYTEA</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">hotel_id</span><span class="p">,</span> <span class="n">image_id</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">hotel_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">hotels</span> <span class="p">(</span><span class="n">hotel_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span> <span class="p">,</span>
    <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">hotel_id</span><span class="p">,</span> <span class="n">image_id</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Only users that are admin can manipulate the images table.</p>
<div class="section" id="id14">
<h3>Operations<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>Operations on the images table is handled with image
class that is given below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Image</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hotel_id</span><span class="p">,</span> <span class="n">file_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hotel_id</span> <span class="o">=</span> <span class="n">hotel_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_data</span> <span class="o">=</span> <span class="n">file_data</span>
</pre></div>
</div>
<p>This class corresponds the images table in the database.
The attributes are same with images table.
This class provides ease on operations on the images table.</p>
<p>The operations on the images table are handled with given below class.
With this class database connection is provided and operations are handled with
functions of this class</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Image</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;postgres://itucs:itucspw@localhost:32768/itucsdb&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Operations on the tickets table is listed below.</p>
<div class="section" id="id15">
<h4>Insert<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>file_data is BLOB and the data for file_data is provided with given below code.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">logo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;images&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>Insertion of image on images table can be performed with
given below code;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO images ( hotel_id, file_data) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">hotel_id</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">file_data</span><span class="p">))</span>
</pre></div>
</div>
<p>This method takes image parameter which is v class.
Foreign key’s information are coming from other related tables and session.
With this insertion method, new image will be added as a row to images table.</p>
</div>
<div class="section" id="id16">
<h4>Read<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<p>There are two different methods for reading data from
images table. These methods are given below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hotel_id</span><span class="p">,</span> <span class="n">image_id</span><span class="p">):</span>
    <span class="n">_image</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM images WHERE hotel_id = </span><span class="si">%s</span><span class="s2"> AND image_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">hotel_id</span><span class="p">,</span> <span class="n">image_id</span><span class="p">,))</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">_image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_image</span>

<span class="k">def</span> <span class="nf">get_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM images;&quot;</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_image</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_image</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">images</span>
</pre></div>
</div>
<p>get_images used for getting the whole information in images table.
This methods returns an array that created with tuple
which is image_id, hotel_id and image as image class.</p>
<p>get_image method takes hotel_id and image_id as parameter.
get_image method is used for returning desired image
by matching hotel_id and image_id.</p>
<p>The file_date of the image is stored as BLOB. For showing image
as picture format, the data of the image decoded with given code below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">base64</span> <span class="kn">import</span> <span class="n">b64encode</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">b64encode</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">file_data</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="id17">
<h4>Update<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<p>Since images are BLOB type, the updating is handled with delete existing image
and add a new one.</p>
</div>
<div class="section" id="id18">
<h4>Delete<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h4>
<p>Delete operation is handled with given code below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hotel_id</span><span class="p">,</span> <span class="n">image_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM images WHERE hotel_id = </span><span class="si">%s</span><span class="s2"> AND image_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">hotel_id</span><span class="p">,</span> <span class="n">image_id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The deletion of image is handled with delete_image method. The selected image
will be deleted in images table by matching hotel_id and image_id taken as parameter.</p>
</div>
</div>
</div>
<div class="section" id="seats-table">
<h2>seats Table<a class="headerlink" href="#seats-table" title="Permalink to this headline">¶</a></h2>
<p>seats table is created for holding the taken seats of the expeditions.
seats table is used for store the information about seats.
The attributes of seats table are expedition_id, user_id and seat_number,
expedition_id, user_id and seat_number are primary key for seats table.
expedition_id is foreign key and the reference of the
expedition_id is expedition_id attribute of the expeditions table.
user_id is foreign key and the reference of the
user_id is user_id attribute of the users table.</p>
<div class="figure" id="id30">
<a class="reference internal image-reference" href="../_images/seats.png"><img alt="seats table" src="../_images/seats.png" style="width: 960.0px; height: 541.5px;" /></a>
<p class="caption"><span class="caption-text">Figure 6 - seats table</span></p>
</div>
<p>Creation of seats table and types of attributes of seats table are given below;</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">seats</span><span class="p">(</span>
    <span class="n">expedition_id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">user_id</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">seat_number</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">expedition_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">seat_number</span><span class="p">),</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">expedition_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">expeditions</span> <span class="p">(</span><span class="n">expedition_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span> <span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">users</span> <span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span> <span class="p">,</span>
    <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">expedition_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">seat_number</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Only users can manipulate the seats table.</p>
<div class="section" id="id19">
<h3>Operations<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>Operations on the tickets table is handled with expedition
class that is given below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Seat</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expedition_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">seat_number</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expedition_id</span> <span class="o">=</span> <span class="n">expedition_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seat_number</span> <span class="o">=</span> <span class="n">seat_number</span>
</pre></div>
</div>
<p>This class corresponds the seats table in the database.
The attributes are same with seats table.
This class provides ease on operations on the seats table.</p>
<p>The operations on the seats table are handled with given below class.
With this class database connection is provided and operations are handled with
functions of this class</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Seat</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;postgres://itucs:itucspw@localhost:32768/itucsdb&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Operations on the seats table is listed below.</p>
<div class="section" id="id20">
<h4>Insert<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h4>
<p>Insertion of seat on seats table can be performed with
given below code;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_seat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seat</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO seats ( expedition_id, user_id, seat_number) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">seat</span><span class="o">.</span><span class="n">expedition_id</span><span class="p">,</span> <span class="n">seat</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">seat</span><span class="o">.</span><span class="n">seat_number</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>This method takes seat parameter which is seat class.
Foreign key’s information are coming from other related tables and session.
With this insertion method, new seat will be added as a row to seats table.</p>
</div>
<div class="section" id="id21">
<h4>Read<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h4>
<p>There are two different methods for reading data from
seats table. These methods are given below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_seats_of_expedition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expedition_id</span><span class="p">):</span>
    <span class="n">seats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM seats WHERE expedition_id = </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">expedition_id</span><span class="p">,</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">seat</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_seat</span> <span class="o">=</span> <span class="n">Seat</span><span class="p">(</span><span class="n">seat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seat</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">seat</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">seats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_seat</span><span class="p">)</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">seats</span>

<span class="k">def</span> <span class="nf">get_seat_of_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expedition_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
    <span class="n">seats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM seats WHERE expedition_id = </span><span class="si">%s</span><span class="s2"> AND user_id = </span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">expedition_id</span><span class="p">,</span> <span class="n">user_id</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">seat</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_seat</span> <span class="o">=</span> <span class="n">Seat</span><span class="p">(</span><span class="n">seat</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">seat</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">seat</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">seats</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_seat</span><span class="p">)</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">seats</span>
</pre></div>
</div>
<p>get_seats_of_expedition method takes expedition_id as parameter.
This method used for getting the expeditions’s seats by matching expedition_id.
This methods returns an array.</p>
<p>get_seat_of_user method takes expedition_id and user_id as parameter.
get_seat_of_user method is used for returning desired seats
by matching expedition_id and user_id.
This methods returns an array of tuples that created with expedition_id, user_id and seat as seat class .</p>
</div>
<div class="section" id="id22">
<h4>Update<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<p>Update seat operation can be handled with given code below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_seat_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seat</span><span class="p">,</span> <span class="n">new_seat_number</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;UPDATE seats SET seat_number = </span><span class="si">%s</span><span class="s2"> WHERE expedition_id = </span><span class="si">%s</span><span class="s2"> AND user_id = </span><span class="si">%s</span><span class="s2"> AND seat_number = </span><span class="si">%s</span><span class="s2"> &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span> <span class="n">new_seat_number</span><span class="p">,</span> <span class="n">seat</span><span class="o">.</span><span class="n">expedition_id</span><span class="p">,</span> <span class="n">seat</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">seat</span><span class="o">.</span><span class="n">seat_number</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>update_seat_number method takes seat as seat class ,new_seat_number as parameter.
This method updates the user’s seat_number with new_seat_number that are taken as parameter.</p>
<p>After update operations, seats table will be updated.</p>
</div>
<div class="section" id="id23">
<h4>Delete<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h4>
<p>Delete operation is handled with given code below;</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_seat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seat</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM seats WHERE expedition_id = </span><span class="si">%s</span><span class="s2"> AND user_id = </span><span class="si">%s</span><span class="s2"> AND seat_number = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">seat</span><span class="o">.</span><span class="n">expedition_id</span><span class="p">,</span> <span class="n">seat</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span> <span class="n">seat</span><span class="o">.</span><span class="n">seat_number</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The deletion of seat is handled with delete_seat method. The selected seat
will be deleted in tickets table by matching seat taken as parameter.</p>
</div>
</div>
<div class="section" id="id24">
<h3>Related Systems<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<p>The usage of the seats table are listed below.</p>
<div class="section" id="seat-selection-on-buying-and-editing-ticket">
<h4>Seat Selection On Buying And Editing Ticket<a class="headerlink" href="#seat-selection-on-buying-and-editing-ticket" title="Permalink to this headline">¶</a></h4>
<p>When user tries to buy ticket or edit their ticket, seat table is used.
The usage is that, user should select a seat that are not taken by another
user. This is provided with given code below;</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% for i in range (expedition.total_cap) %}
    {% if i%6 == 0 %}
        &lt;li  class=&quot;row row--{{ i/6  }}&quot;&gt;
    {% endif %}
        &lt;ol class=&quot;seats&quot; type=&quot;A&quot;&gt;
            &lt;li class=&quot;seat&quot;&gt;
            {% for seat in seats if seat.seat_number == i %}
                &lt;input disabled name=&quot;seat&quot; type=&quot;checkbox&quot; value=&quot;{{ i }}&quot; id=&quot;{{ i }}&quot;&gt;
                {% else %}
                    &lt;input  name=&quot;seat&quot; type=&quot;checkbox&quot; value=&quot;{{ i }}&quot; id=&quot;{{ i }}&quot;&gt;
            {% endfor %}


              &lt;label for=&quot;{{ i }}&quot;&gt;
                    {% if i &lt;10 %}
                        00{{ i }}
                    {% elif i &lt;100 %}
                        0{{ i }}
                    {% else %}
                        {{ i }}
                    {% endif %}
              &lt;/label&gt;
            &lt;/li&gt;
        &lt;/ol&gt;
    {% if i%6 == 5 %}
        &lt;/li&gt;
    {% endif %}

{% endfor %}
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="member2.html" class="btn btn-neutral" title="Parts Implemented by Muhammed Raşit EROL" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, ITUCSDB1835

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>