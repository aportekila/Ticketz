

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Parts Implemented by Muhammed Raşit EROL &mdash; ITUCSDB1835  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Parts Implemented by Abdullah AKGÜL" href="member3.html" />
    <link rel="prev" title="Parts Implemented by Ufuk DEMİR" href="member1.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> ITUCSDB1835
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#database-design">Database Design</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#code">Code</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="member1.html">Parts Implemented by Ufuk DEMİR</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Parts Implemented by Muhammed Raşit EROL</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#firms-table">firms Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#drivers-table">drivers Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#vehicles-table">vehicles Table</a></li>
<li class="toctree-l4"><a class="reference internal" href="#images-for-firms-table">images_for_firms Table</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="member3.html">Parts Implemented by Abdullah AKGÜL</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ITUCSDB1835</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Developer Guide</a> &raquo;</li>
        
      <li>Parts Implemented by Muhammed Raşit EROL</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/developer/member2.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="parts-implemented-by-muhammed-rasit-erol">
<h1>Parts Implemented by Muhammed Raşit EROL<a class="headerlink" href="#parts-implemented-by-muhammed-rasit-erol" title="Permalink to this headline">¶</a></h1>
<p>In this section, there are three main tables which are firms, drivers and vehicles; moreover,
images_for_firms table is extra table.
The responsibility of these tables belongs to Muhammed Raşit EROL.
Attributes of tables which are mentioned above can be seen in Figure 1.</p>
<div class="figure" id="id18">
<a class="reference internal image-reference" href="../_images/all_tables.PNG"><img alt="Muhammed Raşit EROL's tables" src="../_images/all_tables.PNG" style="width: 584.25px; height: 371.25px;" /></a>
<p class="caption"><span class="caption-text">Figure 1 - Tables that implemented by Muhammed Raşit EROL</span></p>
</div>
<div class="section" id="firms-table">
<h2>firms Table<a class="headerlink" href="#firms-table" title="Permalink to this headline">¶</a></h2>
<p>firms table is created for adding and editing expeditions.
Hence, a user is able to see expeditions which are created by firms.
In order organize that operations, firms table is developed as another users table.
However, instead of storing detailed user information, firms table stores information
which are useful for viewing expeditions. Thus, a user can visit firm page which is appeared
in the expedition card. However, main duty of the firms is creating and editing expeditions
which are appears in the user main page. In order the perform that,
email and password attributes are used in the firms table. Other attributes
which are name, phone, city, address, website, description and logo, are used for
getting detailed information when visiting the firm page. The attribute city is used as
foreign key. Also, logo is stored as BLOB type in the database. Moreover,
email and password cannot be NULL because a firm must have these attributes
due to the proper login; furthermore, name and phone cannot be NULL
due to need of at least one contact information and reason for
illogical situation if there is no name for a firm. Also, firm_id is primary key
for firms table and its serially increased by the system.</p>
<div class="figure" id="id19">
<a class="reference internal image-reference" href="../_images/all_tables.PNG"><img alt="firms table" src="../_images/all_tables.PNG" style="width: 584.25px; height: 371.25px;" /></a>
<p class="caption"><span class="caption-text">Figure 2 - firms table</span></p>
</div>
<p>The creation code of
the firms table can be seen below.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">firms</span>
    <span class="p">(</span>
        <span class="n">firm_id</span> <span class="nb">SERIAL</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
        <span class="n">name</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">password</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">email</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">phone</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">city</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">address</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">100</span><span class="p">),</span>
        <span class="n">website</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">20</span><span class="p">),</span>
        <span class="n">description</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">200</span><span class="p">),</span>
        <span class="n">logo</span> <span class="n">BYTEA</span><span class="p">,</span>
        <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">city</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">city</span> <span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">RESTRICT</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span>

    <span class="p">)</span>
</pre></div>
</div>
<p>All operations of the firms table can be seen below:</p>
<div class="section" id="operations">
<h3>Operations<a class="headerlink" href="#operations" title="Permalink to this headline">¶</a></h3>
<p>Inserting, reading, updating, deleting and searching operations can be performed on the firms table.</p>
<p>The attributes of the firms table correspond the parameters on the Firm class.
Hence, with this approach, it is easy to manage the data which stands for attributes of the firms table.
The Firm class can be seen below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Firm</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">website</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">logo</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phone</span> <span class="o">=</span> <span class="n">phone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">website</span> <span class="o">=</span> <span class="n">website</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logo</span> <span class="o">=</span> <span class="n">logo</span>
</pre></div>
</div>
<p>Also, firm_database class is another class which is used for performing table operations with the methods of the Firm class.
The example add_firm method of Firm class can be seen in the below code. Furthermore, database connection is handled with that class.
Hence, in the firm_database class, all data and methods can be used with the Firm class. Thus, all database operations
are handled with the object oriented approach. The code of firm_database and Firm class can be seen below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">firm_database</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Firm</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Firm</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;postgres://itucs:itucspw@localhost:32768/itucsdb&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">add_firm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="s2">&quot;INSERT INTO firms ( name, password, email, phone, city, address, website, description) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">firm</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">website</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">description</span><span class="p">))</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The operations on the firms table can be seen below.</p>
<div class="section" id="insert">
<h4>Insert<a class="headerlink" href="#insert" title="Permalink to this headline">¶</a></h4>
<p>The insertion on the firms table can be performed with add_firm and add_firm_with_logo functions of Firm class.
These functions are used for adding new firm to the firms table. The add_firm function takes Firm object and it inserts
the new firm using information of Firm object with given parameter. Also, the add_firm_with_logo functions perform same
operation but with the logo. Hence, with these two functions, new firm can be inserted to the firms table.
These functions are called from firm signup page. There is no return value for both two functions.
The code of these functions can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_firm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO firms ( name, password, email, phone, city, address, website, description) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">firm</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">website</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">description</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add_firm_with_logo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm_with_logo</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO firms ( name, password, email, phone, city, address, website, description, logo) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">firm_with_logo</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">firm_with_logo</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">firm_with_logo</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">firm_with_logo</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="n">firm_with_logo</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">firm_with_logo</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">firm_with_logo</span><span class="o">.</span><span class="n">website</span><span class="p">,</span><span class="n">firm_with_logo</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">firm_with_logo</span><span class="o">.</span><span class="n">logo</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="read">
<h4>Read<a class="headerlink" href="#read" title="Permalink to this headline">¶</a></h4>
<p>The read operation on the firms table can be performed with get_firm and get_firms functions of Firm class.
These functions are used for reading existing firm from the firms table. The get_firm function takes firm_id as parameter and
returns corresponding firm from the firms table. However, the get_firms function does not take parameter and returns
all firms from the firms table. The returned values for both functions are Firm class objects.
They used in the application when firm attributes are desired.
These functions are called from firm list page in admin page.
The code of these functions can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_firm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">):</span>
    <span class="n">_firm</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM firms WHERE firm_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">,))</span>
        <span class="n">firm</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">firm</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">_firm</span> <span class="o">=</span> <span class="n">Firm</span><span class="p">(</span><span class="n">firm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_firm</span>

<span class="k">def</span> <span class="nf">get_firms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">firms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM firms;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">firm</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_firm</span> <span class="o">=</span> <span class="n">Firm</span><span class="p">(</span><span class="n">firm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
            <span class="n">firms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">firm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_firm</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">firms</span>
</pre></div>
</div>
<p>Furthermore, there are two more functions which is used for read operations also.
The get_firm_id function takes parameter as Firm object and returns the corresponding firm_id for that.
Also, the get_firm_id_login function takes parameter as email and password and returns the corresponding firm_id for login system.
The get_firm_id_login function is used for validation in the firm login page.
The existence of the firm is checked when a firm want to login.
These functions are called from firm list page in admin page.
The code of these functions can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_firm_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT firm_id FROM firms WHERE name = </span><span class="si">%s</span><span class="s2"> AND password = </span><span class="si">%s</span><span class="s2"> AND email = </span><span class="si">%s</span><span class="s2"> AND phone= </span><span class="si">%s</span><span class="s2">  AND city = </span><span class="si">%s</span><span class="s2"> AND address = </span><span class="si">%s</span><span class="s2"> AND website = </span><span class="si">%s</span><span class="s2"> AND description = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">firm</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">website</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">description</span><span class="p">))</span>
        <span class="n">temp_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">temp_id</span>

<span class="k">def</span> <span class="nf">get_firm_id_login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT firm_id FROM firms WHERE email = </span><span class="si">%s</span><span class="s2"> AND password = </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span>
        <span class="n">temp_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">temp_id</span>
</pre></div>
</div>
</div>
<div class="section" id="update">
<h4>Update<a class="headerlink" href="#update" title="Permalink to this headline">¶</a></h4>
<p>The update operation on the firms table can be performed with update_firm and update_firm_with_logo functions of Firm class.
These functions are used for updating existing firm from the firms table.
The update_firm function takes two parameters which are firm_id and Firm class object, and update the firm with new coming values.
Also, update_firm_with_logo performs same operations but with the logo.
Hence, with these two functions, a firm can be updated at the firms table. These functions are called from firm edit page.
There is no return value for both two functions. The code of these functions can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_firm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">,</span> <span class="n">firm</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;UPDATE firms SET name = </span><span class="si">%s</span><span class="s2">, password = </span><span class="si">%s</span><span class="s2">, email = </span><span class="si">%s</span><span class="s2">, phone = </span><span class="si">%s</span><span class="s2">, city = </span><span class="si">%s</span><span class="s2">, address = </span><span class="si">%s</span><span class="s2">, website = </span><span class="si">%s</span><span class="s2">, description = </span><span class="si">%s</span><span class="s2"> WHERE firm_id = </span><span class="si">%s</span><span class="s2"> &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">firm</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="n">firm</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">website</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">update_firm_with_logo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">,</span> <span class="n">firm</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;UPDATE firms SET name = </span><span class="si">%s</span><span class="s2">, password = </span><span class="si">%s</span><span class="s2">, email = </span><span class="si">%s</span><span class="s2">, phone = </span><span class="si">%s</span><span class="s2">, city = </span><span class="si">%s</span><span class="s2">, address = </span><span class="si">%s</span><span class="s2">, website = </span><span class="si">%s</span><span class="s2">, description = </span><span class="si">%s</span><span class="s2">, logo = </span><span class="si">%s</span><span class="s2"> WHERE firm_id = </span><span class="si">%s</span><span class="s2"> &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">firm</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">email</span><span class="p">,</span><span class="n">firm</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">website</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">firm</span><span class="o">.</span><span class="n">logo</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="delete">
<h4>Delete<a class="headerlink" href="#delete" title="Permalink to this headline">¶</a></h4>
<p>The delete operation on the firms table can be performed with delete_firm and delete_firm_logo functions of Firm class.
These functions are used for deleting existing firm from the firms table and deleting of firm’s logo.
The delete_firm function takes parameter as firm_id and deletes the corresponding firm from the firms table.
Also, the delete_firm_logo function takes parameter as firm_id and deletes the logo of corresponding firm from the firms table.
Hence, with these two functions, a firm or firm logo can be deleted from the firms table.
These functions are called from firm list page. There is no return value for both two functions.
The code of these functions can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_firm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM firms WHERE (firm_id = </span><span class="si">%s</span><span class="s2">) &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">delete_firm_logo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;UPDATE firms SET logo = NULL WHERE firm_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="search">
<h4>Search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h4>
<p>The search operation on the firms table can be performed with search function of Firm class.
This function is used for searching existing firm on the firms table.
That function takes parameter as text and returns the corresponding firm from the firms table.
The text parameter is searched on all attributes of the firms table except the password.
If there is attributes which contains the text parameter then the corresponding firm is returned from function.
Hence, with that function a text can be searched on the firms table.
This functions are called from the function which is called from navbar in the admin page.
The code of this function can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
    <span class="n">firms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">to_search</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM firms WHERE (name like </span><span class="si">%s</span><span class="s2">)  or (email like </span><span class="si">%s</span><span class="s2">) or (city like </span><span class="si">%s</span><span class="s2">) or (address like </span><span class="si">%s</span><span class="s2">)  or (phone like </span><span class="si">%s</span><span class="s2">) or (website like </span><span class="si">%s</span><span class="s2">) or (description like </span><span class="si">%s</span><span class="s2">) or (logo like </span><span class="si">%s</span><span class="s2">)      ;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span><span class="n">to_search</span><span class="p">,</span><span class="n">to_search</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">firm</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_firm</span> <span class="o">=</span> <span class="n">Firm</span><span class="p">(</span><span class="n">firm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">firm</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
            <span class="n">firms</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">firm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_firm</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">firms</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="related-systems">
<h3>Related Systems<a class="headerlink" href="#related-systems" title="Permalink to this headline">¶</a></h3>
<p>There are three system in this section, which provide better workflow for the application. They are listed below.</p>
<div class="section" id="signup">
<h4>Signup<a class="headerlink" href="#signup" title="Permalink to this headline">¶</a></h4>
<p>There is a signup system for firms, which is different than user signup system.
The signup system is used adding new firms to the application.
This is performed with the insert operation of the firms table.
After validation controls, a firm is added to the system as a kind of user.
If validation is not correct then related error pages are returned.
In the signup system, also password is stored after hashing.
The code of signup function can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">firm_signup</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">error</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="n">cities</span> <span class="o">=</span> <span class="n">city_db</span><span class="o">.</span><span class="n">get_all_city</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;firm/signup.html&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">cities</span><span class="o">=</span><span class="n">cities</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>

        <span class="n">firm_name</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;firm_name&quot;</span><span class="p">]</span>
        <span class="n">e_mail</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;e_mail&quot;</span><span class="p">]</span>
        <span class="n">phone</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;phone&quot;</span><span class="p">]</span>
        <span class="n">description</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>
        <span class="n">city</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span>
        <span class="n">address</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
        <span class="n">website</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;website&quot;</span><span class="p">]</span>

        <span class="n">db_password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">salt</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">db_password</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

        <span class="k">if</span> <span class="s2">&quot;logo&quot;</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
            <span class="n">logo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s2">&quot;logo&quot;</span><span class="p">]</span>

            <span class="n">firm_db</span><span class="o">.</span><span class="n">add_firm_with_logo</span><span class="p">(</span>
                <span class="n">Firm</span><span class="p">(</span><span class="n">firm_name</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="n">e_mail</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">website</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">logo</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">firm_db</span><span class="o">.</span><span class="n">add_firm</span><span class="p">(</span><span class="n">Firm</span><span class="p">(</span><span class="n">firm_name</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="n">e_mail</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">website</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">]</span>

        <span class="p">(</span><span class="n">temp_id</span><span class="p">,)</span> <span class="o">=</span> <span class="n">firm_db</span><span class="o">.</span><span class="n">get_firm_id</span><span class="p">(</span>
            <span class="n">Firm</span><span class="p">(</span><span class="n">firm_name</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span> <span class="n">e_mail</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">website</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>

        <span class="c1">#uploaded_files = request.form.getlist(&quot;file[]&quot;)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="s2">&quot;image&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">temp</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
                <span class="nb">file</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span>
                <span class="n">firm_image_db</span><span class="o">.</span><span class="n">add_image</span><span class="p">(</span><span class="n">FirmImage</span><span class="p">(</span><span class="n">temp_id</span><span class="p">,</span> <span class="nb">file</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>

        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;firm_login&#39;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;403_un_authorized.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Moreover, some of the validations which are related to quality of input.
This validation is performed with the JavaScript code.
The code of validation of signup function with JavaScript can be seen in code block below.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">add</span><span class="p">()</span>
<span class="p">{</span>

    <span class="kd">var</span> <span class="nx">$captcha</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;#recaptcha&#39;</span> <span class="p">),</span>
        <span class="nx">response</span> <span class="o">=</span> <span class="nx">grecaptcha</span><span class="p">.</span><span class="nx">getResponse</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.msg-error&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span> <span class="s2">&quot;reCAPTCHA is mandatory&quot;</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">$captcha</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">)</span> <span class="p">){</span>
            <span class="nx">$captcha</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.msg-error&#39;</span> <span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">$captcha</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">);</span>
    <span class="p">}</span>


    <span class="kd">let</span> <span class="nx">fill</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">value_length</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#firm_name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#firm_name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;firm_name&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">value_length</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;firm_name&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">((</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#e_mail&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#e_mail&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="p">)){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;e_mail&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">value_length</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;e_mail&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">((</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#password&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#password&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="p">)){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">value_length</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">((</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#phone&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#phone&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="p">)){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;phone&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">value_length</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;phone&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">fill</span> <span class="o">&amp;&amp;</span> <span class="nx">value_length</span><span class="p">){</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#s&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">(</span><span class="nx">image_count</span><span class="p">)</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;add_firm&quot;</span><span class="p">).</span><span class="nx">submit</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger-length&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger-length&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">);</span>
                <span class="p">},</span> <span class="mi">2500</span><span class="p">);</span>
            <span class="p">});</span>

   <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="login">
<h4>Login<a class="headerlink" href="#login" title="Permalink to this headline">¶</a></h4>
<p>There is a login system for firms, which is similar to user login system.
The firm login system is used for entering the system with a firm nor regular user.
This is performed with the read operation of the firms table.
After validation controls, a firm can login to the system.
One the validation control is comparing hashed password with the coming hashed password from database.
If validation is not correct then related error pages are returned.
The code of login function can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">firm_login</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span><span class="p">:</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;e_mail&#39;</span><span class="p">]</span>
        <span class="n">db_password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">salt</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="n">db_password</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">firm_db</span><span class="o">.</span><span class="n">get_firm_id_login</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">h</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">temp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="p">(</span><span class="n">firm_id</span><span class="p">,)</span> <span class="o">=</span> <span class="n">temp</span>
                <span class="k">print</span><span class="p">(</span><span class="n">firm_id</span><span class="p">)</span>
                <span class="n">session</span><span class="o">.</span><span class="n">permanent</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">session</span><span class="p">[</span><span class="s1">&#39;firm_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">firm_id</span>
                <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s1">&#39;firm_page&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">firm_id</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;firm/login.html&quot;</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;Wrong e mail or password&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;firm/login.html&quot;</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="s2">&quot;Something wents wrong please try again&quot;</span><span class="p">)</span>


    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;GET&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;firm/login.html&quot;</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="bp">None</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&quot;404_not_found.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Moreover, some of the validations which are related to quality of input.
This validation is performed with the JavaScript code.
The code of validation of login function with JavaScript can be seen in code block below.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">function</span> <span class="nx">login</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$captcha</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;#recaptcha&#39;</span> <span class="p">),</span>
        <span class="nx">response</span> <span class="o">=</span> <span class="nx">grecaptcha</span><span class="p">.</span><span class="nx">getResponse</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.msg-error&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">(</span> <span class="s2">&quot;reCAPTCHA is mandatory&quot;</span> <span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nx">$captcha</span><span class="p">.</span><span class="nx">hasClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">)</span> <span class="p">){</span>
            <span class="nx">$captcha</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span> <span class="s1">&#39;.msg-error&#39;</span> <span class="p">).</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">$captcha</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span> <span class="s2">&quot;error&quot;</span> <span class="p">);</span>
    <span class="p">}</span>


    <span class="kd">let</span> <span class="nx">fill</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="kd">let</span> <span class="nx">value_length</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#e_mail&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#e_mail&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;e_mail&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">value_length</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;e_mail&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">((</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#password&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">||</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#password&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="p">)){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
        <span class="nx">value_length</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">borderColor</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">;</span>


    <span class="k">if</span><span class="p">(</span><span class="nx">fill</span> <span class="o">&amp;&amp;</span> <span class="nx">value_length</span><span class="p">){</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;login_firm&quot;</span><span class="p">).</span><span class="nx">submit</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger-length&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.message-box-danger-length&quot;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="mi">750</span><span class="p">);</span>
                <span class="p">},</span> <span class="mi">2500</span><span class="p">);</span>
            <span class="p">});</span>

   <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="drivers-table">
<h2>drivers Table<a class="headerlink" href="#drivers-table" title="Permalink to this headline">¶</a></h2>
<p>drivers table is created due to necessity of the drivers for planes.
Hence, expeditions can include its drivers with its information like gender.
The drivers table contains attributes which are name and gender, in order to store personal information.
For storing contact information, email, phone, city and address attributes are created for drivers table.
The city attribute is foreign key and it shows code in city table. The most important attribute of the drivers table is firms_id.
It is also foreign key for firm_id in firms table. Hence, connection between firms and drivers is created.
With this logic, firms have drivers. Furthermore, name, phone and email cannot be NULL due to need of
at least one contact information and reason for illogical situation if there is no name for a driver.
Also, driver_id is primary key for drivers table and its serially increased by the system.</p>
<div class="figure" id="id20">
<a class="reference internal image-reference" href="../_images/driver_table.PNG"><img alt="drivers table" src="../_images/driver_table.PNG" style="width: 428.25px; height: 251.25px;" /></a>
<p class="caption"><span class="caption-text">Figure 3 - drivers table</span></p>
</div>
<p>The creation code of the drivers table can be seen below.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">drivers</span>
    <span class="p">(</span>
        <span class="n">driver_id</span> <span class="nb">SERIAL</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
        <span class="n">name</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">email</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">gender</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">20</span><span class="p">),</span>
        <span class="n">city</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">2</span><span class="p">),</span>
        <span class="n">address</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">200</span><span class="p">),</span>
        <span class="n">phone</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">firm_id</span> <span class="nb">INT</span><span class="p">,</span>
        <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">city</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">city</span> <span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span><span class="p">,</span>
        <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">firms</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>All operations of the drivers table can be seen below:</p>
<div class="section" id="id1">
<h3>Operations<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Inserting, reading, updating, deleting and searching operations can be performed on the drivers table.</p>
<p>The attributes of the drivers table correspond the parameters on the Driver class.
Hence, with this approach, it is easy to manage the data which stands for attributes of the drivers table.
The Driver class can be seen below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Driver</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">phone</span><span class="p">,</span> <span class="n">firm_id</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gender</span> <span class="o">=</span> <span class="n">gender</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phone</span> <span class="o">=</span> <span class="n">phone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firm_id</span> <span class="o">=</span> <span class="n">firm_id</span>
</pre></div>
</div>
<p>Also, driver_database class is another class which is used for performing table operations with the methods of the Driver class.
The example add_driver method of Driver class can be seen in the below code.
Furthermore, database connection is handled with that class.
Hence, in the driver_database class, all data and methods can be used with the Driver class. Thus, all database operations
are handled with the object oriented approach. The code of driver_database and Driver class can be seen below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">driver_database</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Driver</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Driver</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;postgres://itucs:itucspw@localhost:32768/itucsdb&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">add_driver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="s2">&quot;INSERT INTO drivers ( name, email, gender, city, address, phone, firm_id) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">gender</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">firm_id</span><span class="p">))</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The operations on the drivers table can be seen below.</p>
<div class="section" id="id2">
<h4>Insert<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>The insertion on the drivers table can be performed with add_driver function of Driver class.
This function is used for adding new driver to the drivers table. The add_driver function takes Driver object and it inserts
the new driver using information of Driver object with given parameter.
Hence, with this function, new driver can be inserted to the drivers table.
This function is called from driver add page. There is no return value for this function.
The code of this function can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_driver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO drivers ( name, email, gender, city, address, phone, firm_id) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">gender</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">firm_id</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h4>Read<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>The read operation on the drivers table can be performed with get_driver, get_drivers_for_firms and get_drivers functions of Driver class.
These functions are used for reading existing driver from the drivers table. The get_driver function takes driver_id as parameter and
returns corresponding driver from the drivers table. However, the get_drivers function does not take parameter and returns
all drivers from the drivers table. The returned values for both functions are Driver class objects.
Also, get_drivers_for_firms function takes firm_id as parameter and returns all drivers for the given firm_id.
Hence, with this function, all drivers can be found with the desired firm.
They used in the application when drivers attributes are desired.
These functions are called from driver list page and from driver edit page in firm home page.
The code of these functions can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_driver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver_id</span><span class="p">):</span>
     <span class="n">_driver</span> <span class="o">=</span> <span class="bp">None</span>
     <span class="k">try</span><span class="p">:</span>
         <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
         <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
         <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM drivers WHERE driver_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">driver_id</span><span class="p">,))</span>
         <span class="n">driver</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
         <span class="k">if</span> <span class="n">driver</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
             <span class="n">_driver</span> <span class="o">=</span> <span class="n">Driver</span><span class="p">(</span><span class="n">driver</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
         <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
         <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
     <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
         <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
     <span class="k">finally</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
             <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
     <span class="k">return</span> <span class="n">_driver</span>

 <span class="k">def</span> <span class="nf">get_drivers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
     <span class="n">drivers</span> <span class="o">=</span> <span class="p">[]</span>
     <span class="k">try</span><span class="p">:</span>
         <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
         <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
         <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM drivers;&quot;</span><span class="p">)</span>
         <span class="k">for</span> <span class="n">driver</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
             <span class="n">_driver</span> <span class="o">=</span> <span class="n">Driver</span><span class="p">(</span><span class="n">driver</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
             <span class="n">drivers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">driver</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_driver</span><span class="p">))</span>
         <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
         <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
     <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
         <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
     <span class="k">finally</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
             <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
     <span class="k">return</span> <span class="n">drivers</span>

 <span class="k">def</span> <span class="nf">get_drivers_for_firms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">):</span>
     <span class="n">drivers</span> <span class="o">=</span> <span class="p">[]</span>
     <span class="k">try</span><span class="p">:</span>
         <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
         <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
         <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM drivers WHERE (firm_id = </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,(</span><span class="n">firm_id</span><span class="p">,))</span>
         <span class="k">for</span> <span class="n">driver</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
             <span class="n">_driver</span> <span class="o">=</span> <span class="n">Driver</span><span class="p">(</span><span class="n">driver</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
             <span class="n">drivers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">driver</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_driver</span><span class="p">))</span>
         <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
         <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
     <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
         <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
     <span class="k">finally</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
             <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
     <span class="k">return</span> <span class="n">drivers</span>
</pre></div>
</div>
<p>Furthermore, there are two more functions which is used for read operations also.
The get_driver_id function takes parameter as Driver object and returns the corresponding driver_id for that.
Also, the get_firm_ids function takes parameter as driver_id and returns the corresponding firm ids for that driver_id.
The code of these functions can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_driver_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT driver_id FROM drivers WHERE name = </span><span class="si">%s</span><span class="s2"> AND email = </span><span class="si">%s</span><span class="s2"> AND gender = </span><span class="si">%s</span><span class="s2"> AND city = </span><span class="si">%s</span><span class="s2"> AND address = </span><span class="si">%s</span><span class="s2"> AND phone= </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">gender</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">phone</span><span class="p">))</span>
        <span class="n">temp_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">temp_id</span>

<span class="k">def</span> <span class="nf">get_firm_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT firm_id FROM drivers WHERE driver_id = </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">driver_id</span><span class="p">,))</span>
        <span class="n">firm_ids</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">firm_ids</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h4>Update<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>The update operation on the drivers table can be performed with update_driver function of Driver class.
This function is used for updating existing driver from the drivers table.
The update_driver function takes two parameters which are driver_id and Driver class object, and update the driver with new coming values.
Hence, with this function, a driver can be updated at the drivers table. This function is called from driver edit page.
There is no return value for this function. The code of this function can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_driver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver_id</span><span class="p">,</span> <span class="n">driver</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;UPDATE drivers SET name = </span><span class="si">%s</span><span class="s2">, email = </span><span class="si">%s</span><span class="s2">, gender = </span><span class="si">%s</span><span class="s2">, city = </span><span class="si">%s</span><span class="s2">, address = </span><span class="si">%s</span><span class="s2">, phone = </span><span class="si">%s</span><span class="s2">, firm_id = </span><span class="si">%s</span><span class="s2"> WHERE driver_id= </span><span class="si">%s</span><span class="s2"> &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">driver</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">gender</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">city</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">phone</span><span class="p">,</span> <span class="n">driver</span><span class="o">.</span><span class="n">firm_id</span><span class="p">,</span> <span class="n">driver_id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h4>Delete<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<p>The delete operation on the drivers table can be performed with delete_driver function of Driver class.
These functions are used for deleting existing driver from the drivers table.
The delete_driver function takes parameter as driver_id and deletes the corresponding driver from the drivers table.
Hence, with this function, a driver can be deleted from the drivers table.
This function is called from drivers list page. There is no return value for this function.
The code of this function can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_driver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">driver_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM drivers WHERE driver_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">driver_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h4>Search<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<p>The search operation on the drivers table can be performed with search function of Driver class.
This function is used for searching existing driver on the drivers table.
That function takes parameter as text and firm_id and returns the corresponding driver from the drivers table.
The text parameter is searched on all attributes of the drivers table.
If there is attributes which contains the text parameter and firm_id of driver matches the parameter firm_id then the corresponding driver is returned from function.
Hence, with that function a text can be searched on the drivers table.
This functions are called from the function which is called from navbar in the firm pages.
The code of this function can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">):</span>
    <span class="n">drivers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">to_search</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM drivers WHERE ((name like </span><span class="si">%s</span><span class="s2">)  or (email like </span><span class="si">%s</span><span class="s2">) or (gender like </span><span class="si">%s</span><span class="s2">) or (city like </span><span class="si">%s</span><span class="s2">) or (address like </span><span class="si">%s</span><span class="s2">)  or (phone like </span><span class="si">%s</span><span class="s2">) ) and firm_id=</span><span class="si">%s</span><span class="s2"> ;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span><span class="n">firm_id</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">driver</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_driver</span> <span class="o">=</span> <span class="n">Driver</span><span class="p">(</span><span class="n">driver</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">driver</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
            <span class="n">drivers</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">driver</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_driver</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">drivers</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="vehicles-table">
<h2>vehicles Table<a class="headerlink" href="#vehicles-table" title="Permalink to this headline">¶</a></h2>
<p>vehicles table is created due to necessity of the vehicle for expeditions.
Hence, expeditions can include its vehicles with its information like capacity and.
The vehicles table contains attributes which are name, category, model, production_year, production_place, description and document,
in order to store technical information of vehicle. Also, capacity is used for representing capacity of the plane.
The most important attribute of the vehicles table is firms_id. It is also foreign key for firm_id in firms table.
Hence, connection between firms and vehicles is created. Also, document is stored as BLOB type in the database.
Except description and document all attributes cannot be NULL because all not NULL attributes are crucial for vehicle information.
Also, vehicle_id is primary key for vehicles table and its serially increased by the system.</p>
<div class="figure" id="id21">
<a class="reference internal image-reference" href="../_images/vehicle_table.PNG"><img alt="vehicles table" src="../_images/vehicle_table.PNG" style="width: 438.0px; height: 271.5px;" /></a>
<p class="caption"><span class="caption-text">Figure 4 - vehicles table</span></p>
</div>
<p>The creation code of the vehicles table can be seen below.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">vehicles</span>
      <span class="p">(</span>
          <span class="n">vehicle_id</span> <span class="nb">SERIAL</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
          <span class="n">name</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
          <span class="n">category</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
          <span class="n">model</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
          <span class="n">capacity</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
          <span class="n">production_year</span> <span class="nb">INT</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
          <span class="n">production_place</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
          <span class="n">description</span> <span class="nb">VARCHAR</span> <span class="p">(</span><span class="mi">200</span><span class="p">),</span>
          <span class="n">document</span> <span class="n">BYTEA</span><span class="p">,</span>
          <span class="n">firm_id</span> <span class="nb">INT</span><span class="p">,</span>
          <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">firms</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">)</span>

      <span class="p">)</span>
</pre></div>
</div>
<p>All operations of the vehicles table can be seen below:</p>
<div class="section" id="id7">
<h3>Operations<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>Inserting, reading, updating, deleting and searching operations can be performed on the vehicles table.</p>
<p>The attributes of the vehicles table correspond the parameters on the Vehicle class.
Hence, with this approach, it is easy to manage the data which stands for attributes of the vehicles table.
The Vehicle class can be seen below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Vehicle</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">category</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">capacity</span><span class="p">,</span> <span class="n">production_year</span><span class="p">,</span> <span class="n">production_place</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">,</span> <span class="n">document</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">category</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capacity</span> <span class="o">=</span> <span class="n">capacity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">production_year</span> <span class="o">=</span> <span class="n">production_year</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">production_place</span> <span class="o">=</span> <span class="n">production_place</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firm_id</span> <span class="o">=</span> <span class="n">firm_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">document</span> <span class="o">=</span> <span class="n">document</span>
</pre></div>
</div>
<p>Also, vehicle_database class is another class which is used for performing table operations with the methods of the Vehicle class.
The example add_vehicle method of Vehicle class can be seen in the below code.
Furthermore, database connection is handled with that class.
Hence, in the vehicle_database class, all data and methods can be used with the Vehicle class. Thus, all database operations
are handled with the object oriented approach. The code of vehicle_database and Vehicle class can be seen below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">vehicle_database</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vehicle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vehicle</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Vehicle</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;postgres://itucs:itucspw@localhost:32768/itucsdb&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">add_vehicle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="s2">&quot;INSERT INTO vehicles ( name, category, model, capacity, production_year, production_place, description,firm_id) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">production_year</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">production_place</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">firm_id</span><span class="p">))</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The operations on the vehicles table can be seen below.</p>
<div class="section" id="id8">
<h4>Insert<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<p>The insertion on the vehicles table can be performed with add_vehicle and add_vehicle_with_document functions of Vehicle class.
These functions are used for adding new vehicle to the vehicles table. The add_vehicle function takes Vehicle object and it inserts
the new vehicle using information of Vehicle object with given parameter. Also, the add_vehicle_with_document functions perform same
operation but with the pdf document. Hence, with these two functions, new vehicle can be inserted to the vehicles table.
These functions are called from vehicle add page. There is no return value for both two functions.
The code of these functions can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_vehicle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO vehicles ( name, category, model, capacity, production_year, production_place, description,firm_id) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">production_year</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">production_place</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">firm_id</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">add_vehicle_with_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle_with_doc</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO vehicles ( name, category, model, capacity, production_year, production_place, description,firm_id, document ) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">vehicle_with_doc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">vehicle_with_doc</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">vehicle_with_doc</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">vehicle_with_doc</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span> <span class="n">vehicle_with_doc</span><span class="o">.</span><span class="n">production_year</span><span class="p">,</span> <span class="n">vehicle_with_doc</span><span class="o">.</span><span class="n">production_place</span><span class="p">,</span> <span class="n">vehicle_with_doc</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">vehicle_with_doc</span><span class="o">.</span><span class="n">firm_id</span><span class="p">,</span> <span class="n">vehicle_with_doc</span><span class="o">.</span><span class="n">document</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id9">
<h4>Read<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h4>
<p>The read operation on the vehicles table can be performed with get_vehicle, get_vehicles_for_firms and get_vehicles functions of Vehicle class.
These functions are used for reading existing vehicle from the vehicles table. The get_vehicle function takes vehicle_id as parameter and
returns corresponding vehicle from the vehicles table. However, the get_vehicles function does not take parameter and returns
all vehicles from the vehicles table. The returned values for both functions are Vehicle class objects.
Also, get_vehicles_for_firms function takes firm_id as parameter and returns all vehicles for the given firm_id.
Hence, with this function, all vehicles can be found with the desired firm.
They used in the application when vehicles attributes are desired.
These functions are called from vehicle list page and from vehicle edit page in firm home page.
The code of these functions can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_vehicle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle_id</span><span class="p">):</span>
    <span class="n">_vehicle</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vehicles WHERE vehicle_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">vehicle_id</span><span class="p">,))</span>
        <span class="n">vehicle</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">vehicle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">_vehicle</span> <span class="o">=</span> <span class="n">Vehicle</span><span class="p">(</span><span class="n">vehicle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="n">vehicle</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_vehicle</span>

<span class="k">def</span> <span class="nf">get_vehicles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">vehicles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vehicles;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">vehicle</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_vehicle</span> <span class="o">=</span> <span class="n">Vehicle</span><span class="p">(</span><span class="n">vehicle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="n">vehicle</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
            <span class="n">vehicles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vehicle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_vehicle</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">vehicles</span>

<span class="k">def</span> <span class="nf">get_vehicles_for_firms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">):</span>
    <span class="n">vehicles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vehicles WHERE firm_id=</span><span class="si">%s</span><span class="s2">;&quot;</span><span class="p">,(</span><span class="n">firm_id</span><span class="p">,))</span>
        <span class="k">for</span> <span class="n">vehicle</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_vehicle</span> <span class="o">=</span> <span class="n">Vehicle</span><span class="p">(</span><span class="n">vehicle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="n">vehicle</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
            <span class="n">vehicles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vehicle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_vehicle</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">vehicles</span>
</pre></div>
</div>
<p>Furthermore, there are two more functions which is used for read operations also.
The get_vehicle_id function takes parameter as Vehicle object and returns the corresponding vehicle_id for that.
Also, the get_firm_id function takes parameter as vehicle_id and returns the corresponding firm id for that driver_id.
The code of these functions can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_vehicle_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT vehicle_id FROM vehicles WHERE name = </span><span class="si">%s</span><span class="s2"> AND category = </span><span class="si">%s</span><span class="s2"> AND model = </span><span class="si">%s</span><span class="s2"> AND capacity = </span><span class="si">%s</span><span class="s2"> AND production_year = </span><span class="si">%s</span><span class="s2"> AND production_place = </span><span class="si">%s</span><span class="s2">  AND description = </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">production_year</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">production_place</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">description</span><span class="p">))</span>
        <span class="n">temp_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">temp_id</span>


<span class="k">def</span> <span class="nf">get_firm_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle_id</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT firm_id FROM vehicles WHERE vehicle_id = </span><span class="si">%s</span><span class="s2"> &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">vehicle_id</span><span class="p">,))</span>
        <span class="n">firm_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">firm_id</span>
</pre></div>
</div>
</div>
<div class="section" id="id10">
<h4>Update<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h4>
<p>The update operation on the vehicles table can be performed with update_vehicle and update_vehicle_with_document functions of Vehicle class.
These functions are used for updating existing vehicle from the vehicles table.
The update_vehicle function takes two parameters which are vehicle_id and Vehicle class object, and update the vehicle with new coming values.
Also, update_vehicle_with_document performs same operations but with the document.
Hence, with these two functions, a vehicle can be updated at the vehicles table. These functions are called from vehicle edit page.
There is no return value for both two functions. The code of these functions can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_vehicle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle_id</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;UPDATE vehicles SET name = </span><span class="si">%s</span><span class="s2">, category = </span><span class="si">%s</span><span class="s2">, model = </span><span class="si">%s</span><span class="s2">, capacity = </span><span class="si">%s</span><span class="s2">, production_year = </span><span class="si">%s</span><span class="s2">, production_place = </span><span class="si">%s</span><span class="s2">, description = </span><span class="si">%s</span><span class="s2">, firm_id = </span><span class="si">%s</span><span class="s2"> WHERE vehicle_id= </span><span class="si">%s</span><span class="s2"> &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">production_year</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">production_place</span><span class="p">,</span><span class="n">vehicle</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">firm_id</span><span class="p">,</span> <span class="n">vehicle_id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">update_vehicle_with_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle_id</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;UPDATE vehicles SET name = </span><span class="si">%s</span><span class="s2">, category = </span><span class="si">%s</span><span class="s2">, model = </span><span class="si">%s</span><span class="s2">, capacity = </span><span class="si">%s</span><span class="s2">, production_year = </span><span class="si">%s</span><span class="s2">, production_place = </span><span class="si">%s</span><span class="s2">, description = </span><span class="si">%s</span><span class="s2">, firm_id = </span><span class="si">%s</span><span class="s2">, document = </span><span class="si">%s</span><span class="s2"> WHERE vehicle_id = </span><span class="si">%s</span><span class="s2"> &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">vehicle</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">production_year</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">production_place</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">firm_id</span><span class="p">,</span> <span class="n">vehicle</span><span class="o">.</span><span class="n">document</span><span class="p">,</span> <span class="n">vehicle_id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id11">
<h4>Delete<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h4>
<p>The delete operation on the vehicles table can be performed with delete_vehicle and delete_vehicle_document functions of Vehicle class.
These functions are used for deleting existing vehicle from the vehicles table and deleting of vehicle’s document.
The delete_vehicle function takes parameter as vehicle_id and deletes the corresponding vehicle from the vehicles table.
Also, the delete_vehicle_document function takes parameter as vehicle_id and deletes the document of corresponding vehicle from the vehicles table.
Hence, with these two functions, a vehicle or vehicle document can be deleted from the vehicles table.
These functions are called from vehicle list page. There is no return value for both two functions.
The code of these functions can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_vehicle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM vehicles WHERE vehicle_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">vehicle_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">delete_vehicle_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vehicle_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;UPDATE vehicles SET document = NULL WHERE vehicle_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">vehicle_id</span><span class="p">,))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id12">
<h4>Search<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h4>
<p>The search operation on the vehicles table can be performed with search function of Vehicle class.
This function is used for searching existing vehicle on the vehicles table.
That function takes parameter as text and firm_id and returns the corresponding vehicle from the vehicles table.
The text parameter is searched on all attributes of the vehicles table.
If there is attributes which contains the text parameter and firm_id of vehicle matches the parameter firm_id
then the corresponding vehicle is returned from function.
Hence, with that function a text can be searched on the vehicles table.
This functions are called from the function which is called from navbar in the firm pages.
The code of this function can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span><span class="n">firm_id</span><span class="p">):</span>
    <span class="n">vehicles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">to_search</span> <span class="o">=</span> <span class="s2">&quot;%&quot;</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM vehicles  WHERE ((LOWER(name) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(category) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(model) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(CAST(capacity AS VARCHAR )) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(production_year) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(production_place) like LOWER(</span><span class="si">%s</span><span class="s2">)) or (LOWER(description) like LOWER(</span><span class="si">%s</span><span class="s2">)) ) and firm_id = </span><span class="si">%s</span><span class="s2"> ;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span> <span class="n">to_search</span><span class="p">,</span><span class="n">to_search</span><span class="p">,</span><span class="n">firm_id</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">vehicle</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_vehicle</span> <span class="o">=</span> <span class="n">Vehicle</span><span class="p">(</span><span class="n">vehicle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">vehicle</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span><span class="n">vehicle</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
            <span class="n">vehicles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">vehicle</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_vehicle</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">vehicles</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="images-for-firms-table">
<h2>images_for_firms Table<a class="headerlink" href="#images-for-firms-table" title="Permalink to this headline">¶</a></h2>
<p>images_for_firms table is created for storing iamges of firms. A firm can have multiple images in our application.
This table contains attribute file_data as BLOB type and images are stored in it.
There are two primary key attribute which are firm_id and image_id.
The image_id is one of the primary key for images_for_firms table and its serially increased by the system.
The most important attribute of the images_for_firms table is firms_id. It is also foreign key for firm_id in firms table.
Hence, connection between firms and images_for_firms is created.</p>
<div class="figure" id="id22">
<a class="reference internal image-reference" href="../_images/images_table.PNG"><img alt="images_for_firms table" src="../_images/images_table.PNG" style="width: 377.25px; height: 257.25px;" /></a>
<p class="caption"><span class="caption-text">Figure 5 - images_for_firms table</span></p>
</div>
<p>The creation code of the images_for_firms table can be seen below.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">images_for_firms</span><span class="p">(</span>
        <span class="n">firm_id</span> <span class="nb">INT</span><span class="p">,</span>
        <span class="n">image_id</span> <span class="nb">SERIAL</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
        <span class="n">file_data</span> <span class="n">BYTEA</span><span class="p">,</span>
        <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">,</span> <span class="n">image_id</span><span class="p">),</span>
        <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">firms</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">)</span> <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">CASCADE</span> <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span> <span class="p">,</span>
        <span class="k">UNIQUE</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">,</span> <span class="n">image_id</span><span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>All operations of the images_for_firms table can be seen below:</p>
<div class="section" id="id13">
<h3>Operations<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>Inserting, reading, updating, deleting and searching operations can be performed on the images_for_firms table.</p>
<p>The attributes of the images_for_firms table correspond the parameters on the FirmImage class.
Hence, with this approach, it is easy to manage the data which stands for attributes of the images_for_firms table.
The Firm class can be seen below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FirmImage</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">,</span> <span class="n">file_data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firm_id</span> <span class="o">=</span> <span class="n">firm_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_data</span> <span class="o">=</span> <span class="n">file_data</span>
</pre></div>
</div>
<p>Also, firm_image_database class is another class which is used for performing table operations with the methods of the FirmImage class.
The example add_image method of FirmImage class can be seen in the below code. Furthermore, database connection is handled with that class.
Hence, in the firm_image_database class, all data and methods can be used with the FirmImage class. Thus, all database operations
are handled with the object oriented approach. The code of firm_image_database and FirmImage class can be seen below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">firm_image_database</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">firm_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FirmImage</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">FirmImage</span><span class="p">:</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;postgres://itucs:itucspw@localhost:32768/itucsdb&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_URL&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">add_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
                <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="s2">&quot;INSERT INTO images_for_firms ( firm_id, file_data) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">firm_id</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">file_data</span><span class="p">))</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The operations on the images_for_firms table can be seen below.</p>
<div class="section" id="id14">
<h4>Insert<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h4>
<p>The insertion on the images_for_firms table can be performed with add_image function of FirmImage class.
This function is used for adding new image to the images_for_firms table. The add_image function takes FirmImage object and it inserts
the new image using information of FirmImage object with given parameter.
Hence, with this function, new image can be inserted to the images_for_firms table.
This function is called from firm signup page. There is no return value for this function.
The code of this function can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO images_for_firms ( firm_id, file_data) VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">firm_id</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">file_data</span><span class="p">))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="id15">
<h4>Read<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>The read operation on the images_for_firms table can be performed with get_image and get_images functions of FirmImage class.
These functions are used for reading existing image from the images_for_firms table. The get_image function takes firm_id and image_id as parameter and
returns corresponding image from the images_for_firms table. However, the get_images function does not take parameter and returns
all images from the images_for_firms table. The returned values for both functions are FirmImage class objects.
They used in the application when images of firms are desired.
These functions are called from firm edit page in firm home page and firm home page.
The code of these functions can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">,</span> <span class="n">image_id</span><span class="p">):</span>
    <span class="n">_image</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM images_for_firms WHERE firm_id = </span><span class="si">%s</span><span class="s2"> AND image_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">,</span> <span class="n">image_id</span><span class="p">,))</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">_image</span> <span class="o">=</span> <span class="n">FirmImage</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">_image</span>

<span class="k">def</span> <span class="nf">get_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">images</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM images_for_firms;&quot;</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">_image</span> <span class="o">=</span> <span class="n">FirmImage</span><span class="p">(</span><span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">image</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">images</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_image</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">images</span>
</pre></div>
</div>
</div>
<div class="section" id="id16">
<h4>Update<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h4>
<p>Since images are BLOB type, the updating is handled with delete existing image
and add a new one.</p>
</div>
<div class="section" id="id17">
<h4>Delete<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<p>The delete operation on the images_for_firms table can be performed with delete_image function of FirmImage class.
These functions are used for deleting existing image from the images_for_firms table.
The delete_image function takes parameter as firm_id and image_id and deletes the corresponding image from the images_for_firms table.
Hence, with this function, a image can be deleted from the images_for_firms table.
This function is called from firm edit page. There is no return value for this function.
The code of this function can be seen in code block below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">delete_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">firm_id</span><span class="p">,</span> <span class="n">image_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span> <span class="o">=</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM images_for_firms WHERE firm_id = </span><span class="si">%s</span><span class="s2"> AND image_id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">firm_id</span><span class="p">,</span> <span class="n">image_id</span><span class="p">))</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">,</span> <span class="n">dbapi2</span><span class="o">.</span><span class="n">DatabaseError</span><span class="p">)</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">connection</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="member3.html" class="btn btn-neutral float-right" title="Parts Implemented by Abdullah AKGÜL" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="member1.html" class="btn btn-neutral" title="Parts Implemented by Ufuk DEMİR" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, ITUCSDB1835

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>